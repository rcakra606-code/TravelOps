<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tours Dashboard - TravelOps</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/modern-normalize/1.1.0/modern-normalize.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/css/app-v2.css">
<link rel="stylesheet" href="/css/dashboard.css">
<link rel="stylesheet" href="/css/modal.css">
<link rel="stylesheet" href="/css/table-enhancements.css">
<link rel="stylesheet" href="/css/filter-enhancements.css">
<link rel="stylesheet" href="/css/status-badges.css">
<link rel="stylesheet" href="/css/animations.css">
<link rel="stylesheet" href="/css/mobile-responsive.css">
<link rel="stylesheet" href="/css/dashboard-customization.css">
<link rel="stylesheet" href="/css/empty-states.css">
<link rel="stylesheet" href="/css/form-enhancements.css">
<link rel="stylesheet" href="/css/crud-enhancements.css">
<link rel="stylesheet" href="/css/filter-modal.css">
<link rel="stylesheet" href="/css/ui-enhancements.css">
<link rel="stylesheet" href="/css/sidebar-groups.css">
<link rel="stylesheet" href="/css/dashboard-shared.css">
<link rel="stylesheet" href="/css/tour-wizard.css">
<link rel="stylesheet" href="/css/accessibility.css">
<link rel="stylesheet" href="/css/professional-polish.css">
<link rel="stylesheet" href="/css/seasonal-theme.css">
<link rel="stylesheet" href="/css/futuristic-theme.css">
<style>
  /* My Tours Tab Styles */
  .mt-summary-row { display: flex; gap: 20px; margin-bottom: 24px; flex-wrap: wrap; }
  .mt-summary-item { background: var(--card); padding: 16px 24px; border-radius: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); flex: 1; min-width: 150px; text-align: center; }
  .mt-summary-value { font-size: 28px; font-weight: 700; color: var(--primary); }
  .mt-summary-label { font-size: 13px; color: var(--text-secondary); margin-top: 4px; }
  .mt-stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 24px; }
  .mt-stat-card { background: var(--card, #fff); border-radius: 12px; padding: 20px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
  .mt-stat-card h4 { font-size: 14px; color: var(--text-secondary); margin: 0 0 16px 0; display: flex; align-items: center; gap: 8px; }
  .mt-stat-items { display: flex; flex-direction: column; gap: 12px; }
  .mt-stat-row { display: flex; justify-content: space-between; align-items: center; }
  .mt-stat-label { display: flex; align-items: center; gap: 8px; font-size: 14px; }
  .mt-stat-badge { padding: 4px 10px; border-radius: 20px; font-size: 13px; font-weight: 600; }
  .mt-stat-badge.pending { background: #fef3c7; color: #92400e; }
  .mt-stat-badge.completed { background: #d1fae5; color: #065f46; }
  .mt-stat-badge.cancelled { background: #fee2e2; color: #991b1b; }
  .mt-stat-badge.invoiced { background: #dbeafe; color: #1e40af; }
  .mt-stat-badge.not-invoiced { background: #f3f4f6; color: #4b5563; }
  .mt-big-number { font-size: 28px; font-weight: 700; line-height: 1; }
  .mt-progress-bar { height: 8px; background: var(--bg-alt); border-radius: 4px; overflow: hidden; margin-top: 8px; }
  .mt-progress-fill { height: 100%; border-radius: 4px; transition: width 0.5s ease; }
  .mt-progress-fill.pending { background: #f59e0b; }
  .mt-progress-fill.completed { background: #10b981; }
  .mt-progress-fill.cancelled { background: #ef4444; }
  .mt-invoice-status { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 500; }
  .mt-invoice-status.yes { background: #d1fae5; color: #065f46; }
  .mt-invoice-status.no { background: #fee2e2; color: #991b1b; }
  .mt-status-chip { padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 500; display: inline-flex; align-items: center; gap: 4px; }
  .mt-status-chip.pending { background: #fef3c7; color: #92400e; }
  .mt-status-chip.completed { background: #d1fae5; color: #065f46; }
  .mt-status-chip.cancelled { background: #fee2e2; color: #991b1b; }
  .tab-count { font-size: 11px; background: rgba(255,255,255,0.2); padding: 2px 8px; border-radius: 10px; margin-left: 4px; }
  .tab-btn.active .tab-count { background: rgba(255,255,255,0.3); }

  /* Archived Tours Summary */
  .at-summary-row { display: flex; gap: 20px; margin-bottom: 24px; flex-wrap: wrap; }
  .at-summary-item { background: var(--card); padding: 16px 24px; border-radius: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); flex: 1; min-width: 150px; text-align: center; }
  .at-summary-value { font-size: 28px; font-weight: 700; color: var(--text-secondary); }
  .at-summary-label { font-size: 13px; color: var(--text-secondary); margin-top: 4px; }
</style>
<script src="/js/seasonal-theme.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
<button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle menu">â˜°</button>
<div class="mobile-overlay" id="mobileOverlay"></div>
<div class="app">
  <aside class="sidebar">
    <div class="brand">ğŸš€ TravelOps</div>
    <div class="nav">
      <!-- Main Dashboard -->
      <a href="/single-dashboard.html" class="nav-main-item">ğŸ  Main Dashboard</a>
      
      <!-- Product Input Group -->
      <div class="nav-group" id="groupProductInput">
        <button class="nav-group-header" data-group="product-input">
          <span class="group-icon">ğŸ“¦</span>
          <span class="group-title">Product Input</span>
          <span class="group-arrow">â–¼</span>
        </button>
        <div class="nav-group-items">
          <a href="/tours-dashboard.html" class="active">ğŸ§³ Tours</a>
          <a href="/documents-dashboard.html">ğŸ“„ Documents</a>
          <a href="/hotel-dashboard.html">ğŸ¨ Hotel</a>
          <a href="/cruise-dashboard.html">ğŸš¢ Cruise</a>
          <a href="/telecom-dashboard.html">ğŸ“ Telecom</a>
          <a href="/tracking-dashboard.html">ğŸ“¦ Tracking</a>
          <a href="/ticket-recap-dashboard.html">âœˆï¸ Ticket Recap</a>
        </div>
      </div>
      
      <!-- Productivity Group -->
      <div class="nav-group" id="groupProductivity">
        <button class="nav-group-header" data-group="productivity">
          <span class="group-icon">ğŸ“Š</span>
          <span class="group-title">Productivity</span>
          <span class="group-arrow">â–¼</span>
        </button>
        <div class="nav-group-items">
          <a href="/sales-targets-dashboard.html">ğŸ’° Sales & Target</a>
          <a href="/overtime-dashboard.html">â° Overtime</a>
          <a href="/productivity-dashboard.html">ğŸ“ˆ Productivity</a>
        </div>
      </div>

      <!-- Corporate Group -->
      <div class="nav-group" id="groupCorporate">
        <button class="nav-group-header" data-group="corporate">
          <span class="group-icon">ğŸ¢</span>
          <span class="group-title">Corporate</span>
          <span class="group-arrow">â–¼</span>
        </button>
        <div class="nav-group-items">
          <a href="/corporate-dashboard.html">ğŸ“Š Corporate Dashboard</a>
        </div>
      </div>
      
      <!-- Administration Group -->
      <div class="nav-group" id="groupAdmin">
        <button class="nav-group-header" data-group="administration">
          <span class="group-icon">âš™ï¸</span>
          <span class="group-title">Administration</span>
          <span class="group-arrow">â–¼</span>
        </button>
        <div class="nav-group-items">
          <a href="/outstanding-dashboard.html">ğŸ“‹ Outstanding</a>
          <a href="/cashout-dashboard.html">ğŸ’¸ Cash Out</a>
          <a href="/admin-settings.html" id="adminSettingsLink" style="display:none;">âš™ï¸ Admin Settings</a>
          <a href="/logs-dashboard.html">ğŸ“‹ System Logs</a>
        </div>
      </div>
      
      <hr class="nav-divider">
      <a href="/profile.html">ğŸ‘¤ Profile</a>
      <a href="/logout.html" id="logoutLink">ğŸšª Logout</a>
    </div>
    <div class="userbox" style="margin-top:18px">
      <div id="userName">â€”</div>
      <div id="userRole">â€”</div>
    </div>
  </aside>

  <main class="main">
    <div class="header">
      <div>
        <h2>Tours Dashboard</h2>
        <div class="small">Tour analytics & participants by region</div>
      </div>
    </div>

    <!-- Dashboard Tabs -->
    <div class="dashboard-tabs" id="toursDashboardTabs">
      <button class="tab-btn active" data-tab="tour-data">ğŸ§³ Tour Data <span class="tab-count" id="tabCountTourData"></span></button>
      <button class="tab-btn" data-tab="my-tours">ğŸ“‹ My Tours <span class="tab-count" id="tabCountMyTours"></span></button>
      <button class="tab-btn" data-tab="archived-tours">ğŸ“¦ Archived Tours <span class="tab-count" id="tabCountArchived"></span></button>
    </div>

    <!-- TAB: Tour Data (Active Tours) -->
    <div id="tabTourData" class="tab-content">
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
        <h3>Tours Analytics</h3>
      </div>
      
      <!-- Metrics Row -->
      <div class="dashboard-metrics">
        <div class="metric-card">
          <div class="metric-title">Total Participants</div>
          <div class="metric-value" id="totalParticipants">0</div>
          <div class="metric-subtitle">All tours</div>
        </div>

        <div class="metric-card">
          <div class="metric-title">Total Tours</div>
          <div class="metric-value" id="totalTours">0</div>
          <div class="metric-subtitle">Recorded tours</div>
        </div>

        <div class="metric-card">
          <div class="metric-title">Avg Participants</div>
          <div class="metric-value" id="avgParticipants">0</div>
          <div class="metric-subtitle">Per tour</div>
        </div>

        <div class="metric-card">
          <div class="metric-title">Upcoming Departures</div>
          <div class="metric-value" id="upcomingDepartures">0</div>
          <div class="metric-subtitle">Within 30 days</div>
        </div>

        <div class="metric-card">
          <div class="metric-title">Invoiced Tours</div>
          <div class="metric-value" id="invoicedTours">0</div>
          <div class="metric-subtitle">Already invoiced</div>
        </div>

        <div class="metric-card">
          <div class="metric-title">Not Invoiced</div>
          <div class="metric-value" id="notInvoicedTours">0</div>
          <div class="metric-subtitle">Pending invoice</div>
        </div>
      </div>

      <!-- Charts Row 1 -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 24px;">
        <div class="chart-container">
          <div class="chart-header">
            <div class="chart-title">Participants per Month</div>
          </div>
          <canvas id="chartParticipantsMonthly" style="max-height: 300px;"></canvas>
        </div>

        <div class="chart-container">
          <div class="chart-header">
            <div class="chart-title">Participants per Region</div>
          </div>
          <canvas id="chartParticipantsRegion" style="max-height: 300px;"></canvas>
        </div>
      </div>

      <!-- Charts Row 2 -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
        <div class="chart-container">
          <div class="chart-header">
            <div class="chart-title">Top 5 Destinations</div>
          </div>
          <canvas id="chartTopDestinations" style="max-height: 300px;"></canvas>
        </div>

        <div class="chart-container">
          <div class="chart-header">
            <div class="chart-title">Tours per Staff</div>
          </div>
          <canvas id="chartToursPerStaff" style="max-height: 300px;"></canvas>
        </div>
      </div>

      <!-- Charts Row 3 -->
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
        <div class="chart-container">
          <div class="chart-header">
            <div class="chart-title">Departure Timeline (Next 60 Days)</div>
          </div>
          <canvas id="chartDepartureTimeline" style="max-height: 300px;"></canvas>
        </div>

        <div class="chart-container">
          <div class="chart-header">
            <div class="chart-title">Package Type Distribution</div>
          </div>
          <canvas id="chartPackageTypes" style="max-height: 300px;"></canvas>
        </div>
      </div>

      <!-- Upcoming Departures Table -->
      <div class="chart-container" style="margin-top: 20px;">
        <div class="chart-header">
          <div class="chart-title">âš ï¸ Upcoming Departures (Next 7 Days)</div>
        </div>
        <div style="padding: 16px;">
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="border-bottom: 2px solid #e5e7eb;">
                <th style="padding: 8px; text-align: left;">Departure Date</th>
                <th style="padding: 8px; text-align: left;">Tour Name</th>
                <th style="padding: 8px; text-align: left;">Region</th>
                <th style="padding: 8px; text-align: right;">Participants</th>
                <th style="padding: 8px; text-align: left;">Staff</th>
              </tr>
            </thead>
            <tbody id="upcomingToursTable">
              <tr><td colspan="5" style="padding: 20px; text-align: center; color: #9ca3af;">Loading...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Search and Filter Bar -->
    <div class="card" style="margin-top: 20px; margin-bottom: 16px;">
      <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
        <input 
          type="text" 
          id="searchInput" 
          placeholder="ğŸ” Search tour code, destination, lead pax..." 
          style="flex: 1; min-width: 250px;"
        />
        <select id="filterYear" style="min-width: 120px;">
          <option value="">All Years</option>
        </select>
        <select id="filterMonth" style="min-width: 130px;">
          <option value="">All Months</option>
          <option value="01">January</option>
          <option value="02">February</option>
          <option value="03">March</option>
          <option value="04">April</option>
          <option value="05">May</option>
          <option value="06">June</option>
          <option value="07">July</option>
          <option value="08">August</option>
          <option value="09">September</option>
          <option value="10">October</option>
          <option value="11">November</option>
          <option value="12">December</option>
        </select>
        <select id="filterRegion" style="min-width: 140px;">
          <option value="">All Regions</option>
          <option value="Domestik">Domestik</option>
          <option value="China">China</option>
          <option value="APJ">APJ</option>
          <option value="EAMEA">EAMEA</option>
        </select>
        <select id="filterStatus" style="min-width: 140px;">
          <option value="">All Status</option>
          <option value="pending">Pending</option>
          <option value="confirmed">Confirmed</option>
          <option value="invoiced">Invoiced</option>
          <option value="completed">Completed</option>
          <option value="cancelled">Cancelled</option>
        </select>
        <select id="filterStaff" style="min-width: 140px;">
          <option value="">All Staff</option>
        </select>
        <button id="clearFilters" class="btn btn-secondary">ğŸ”„ Reset</button>
        <button id="exportToursCSV" class="btn btn-outline">ğŸ“Š Export</button>
      </div>
    </div>

    <!-- Tours Data Table with CRUD -->
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
        <h3>ğŸ“‹ Tours Records</h3>
        <div style="display: flex; gap: 10px; align-items: center;">
          <label style="display: flex; align-items: center; gap: 5px; font-size: 14px;">
            Show
            <select id="toursItemsPerPage" style="padding: 6px 8px; border: 1px solid var(--border-medium); border-radius: 4px;">
              <option value="10">10</option>
              <option value="25">25</option>
              <option value="50">50</option>
              <option value="100">100</option>
            </select>
            entries
          </label>
          <button id="addTourBtn" class="btn btn-primary" title="Keyboard shortcut: Alt+N">+ Add Tour</button>
          <button id="archiveTours2025Btn" class="btn btn-secondary" style="display:none;" title="Archive all 2025 tours">ğŸ“¦ Archive 2025</button>
        </div>
      </div>
      
      <div style="overflow-x: auto;">
        <table class="table">
          <thead>
            <tr>
              <th>Tour Code</th>
              <th>Registration</th>
              <th>Departure</th>
              <th>Region</th>
              <th>Lead Passenger</th>
              <th>Pax</th>
              <th>Status</th>
              <th>Staff</th>
              <th>Sales Amount</th>
              <th>Profit</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody id="toursTableBody">
            <tr><td colspan="11" class="text-center">Loading...</td></tr>
          </tbody>
        </table>
      </div>
      
      <!-- Pagination Controls -->
      <div id="toursPagination" style="margin-top: 20px;"></div>
    </div>
    </div><!-- /tabTourData -->

    <!-- TAB: My Tours -->
    <div id="tabMyTours" class="tab-content" style="display:none;">
      <!-- Summary Row (populated by JS) -->
      <div class="mt-summary-row">
        <div class="mt-summary-item">
          <div class="mt-summary-value" id="mtTotalTours">0</div>
          <div class="mt-summary-label">Total Tours</div>
        </div>
        <div class="mt-summary-item">
          <div class="mt-summary-value" id="mtTotalPassengers">0</div>
          <div class="mt-summary-label">Total Passengers</div>
        </div>
        <div class="mt-summary-item">
          <div class="mt-summary-value" id="mtTotalSales">Rp 0</div>
          <div class="mt-summary-label">Total Sales</div>
        </div>
        <div class="mt-summary-item">
          <div class="mt-summary-value" id="mtAvgPassengers">0</div>
          <div class="mt-summary-label">Avg Passengers/Tour</div>
        </div>
      </div>

      <!-- Sales by Invoice Status -->
      <div class="mt-stats-grid" style="margin-bottom: 24px;">
        <div class="mt-stat-card" style="background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);">
          <h4 style="color: #166534;">âœ… Invoiced Sales</h4>
          <div class="mt-big-number" id="mtSalesInvoiced" style="color: #16a34a;">Rp 0</div>
          <div style="font-size: 13px; color: #166534; margin-top: 8px;"><span id="mtToursInvoicedCount">0</span> tours with invoice</div>
        </div>
        <div class="mt-stat-card" style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);">
          <h4 style="color: #92400e;">â³ Not Invoiced Yet</h4>
          <div class="mt-big-number" id="mtSalesNotInvoiced" style="color: #d97706;">Rp 0</div>
          <div style="font-size: 13px; color: #92400e; margin-top: 8px;"><span id="mtToursNotInvoicedCount">0</span> tours pending invoice</div>
        </div>
        <div class="mt-stat-card" style="background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%);">
          <h4 style="color: #1e40af;">ğŸ“Š Invoice Coverage</h4>
          <div class="mt-big-number" id="mtInvoiceCoverage" style="color: #2563eb;">0%</div>
          <div style="font-size: 13px; color: #1e40af; margin-top: 8px;">of total sales value invoiced</div>
        </div>
      </div>

      <!-- Statistics Cards -->
      <div class="mt-stats-grid">
        <div class="mt-stat-card">
          <h4>ğŸš¶ Passengers by Tour Status</h4>
          <div class="mt-stat-items">
            <div class="mt-stat-row"><div class="mt-stat-label"><span>â³</span> Belum Jalan</div><span class="mt-stat-badge pending" id="mtPaxPending">0</span></div>
            <div class="mt-progress-bar"><div class="mt-progress-fill pending" id="mtProgressPending" style="width:0%"></div></div>
            <div class="mt-stat-row"><div class="mt-stat-label"><span>âœ…</span> Sudah Jalan</div><span class="mt-stat-badge completed" id="mtPaxCompleted">0</span></div>
            <div class="mt-progress-bar"><div class="mt-progress-fill completed" id="mtProgressCompleted" style="width:0%"></div></div>
            <div class="mt-stat-row"><div class="mt-stat-label"><span>âŒ</span> Tidak Jalan</div><span class="mt-stat-badge cancelled" id="mtPaxCancelled">0</span></div>
            <div class="mt-progress-bar"><div class="mt-progress-fill cancelled" id="mtProgressCancelled" style="width:0%"></div></div>
          </div>
        </div>
        <div class="mt-stat-card">
          <h4>ğŸ“ Invoice Status</h4>
          <div class="mt-stat-items">
            <div class="mt-stat-row"><div class="mt-stat-label"><span>âœ…</span> Invoiced Tours</div><span class="mt-stat-badge invoiced" id="mtToursInvoiced">0</span></div>
            <div class="mt-stat-row"><div class="mt-stat-label"><span>â³</span> Not Invoiced</div><span class="mt-stat-badge not-invoiced" id="mtToursNotInvoiced">0</span></div>
            <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid var(--border-light);">
              <div class="mt-stat-row"><div class="mt-stat-label" style="font-weight: 600;">Invoice Rate</div><span class="mt-big-number" id="mtInvoiceRate" style="color: var(--primary);">0%</span></div>
            </div>
          </div>
        </div>
        <div class="mt-stat-card">
          <h4>ğŸ—‚ï¸ Tours by Status</h4>
          <div class="mt-stat-items">
            <div class="mt-stat-row"><div class="mt-stat-label"><span>â³</span> Belum Jalan</div><span class="mt-stat-badge pending" id="mtToursPending">0</span></div>
            <div class="mt-stat-row"><div class="mt-stat-label"><span>âœ…</span> Sudah Jalan</div><span class="mt-stat-badge completed" id="mtToursCompleted">0</span></div>
            <div class="mt-stat-row"><div class="mt-stat-label"><span>âŒ</span> Tidak Jalan</div><span class="mt-stat-badge cancelled" id="mtToursCancelled">0</span></div>
          </div>
        </div>
      </div>

      <!-- Search and Filter -->
      <div class="card" style="margin-top: 20px; margin-bottom: 16px;">
        <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
          <input type="text" id="mtSearchInput" placeholder="ğŸ” Search tour code, passenger, booking code..." style="flex: 1; min-width: 250px;" />
          <div id="mtStaffFilterGroup" style="display:none; align-items: center; gap: 4px;">
            <label style="font-size: 12px; color: var(--text-secondary); margin-right: 4px;">ğŸ‘¤ User:</label>
            <select id="mtFilterStaff" style="min-width: 140px;"><option value="">All Users</option></select>
          </div>
          <select id="mtFilterYear" style="min-width: 120px;"><option value="">All Years</option></select>
          <select id="mtFilterMonth" style="min-width: 130px;">
            <option value="">All Months</option>
            <option value="01">January</option><option value="02">February</option><option value="03">March</option>
            <option value="04">April</option><option value="05">May</option><option value="06">June</option>
            <option value="07">July</option><option value="08">August</option><option value="09">September</option>
            <option value="10">October</option><option value="11">November</option><option value="12">December</option>
          </select>
          <select id="mtFilterStatus" style="min-width: 140px;">
            <option value="">All Status</option>
            <option value="belum jalan">â³ Belum Jalan</option>
            <option value="sudah jalan">âœ… Sudah Jalan</option>
            <option value="tidak jalan">âŒ Tidak Jalan</option>
          </select>
          <select id="mtFilterInvoice" style="min-width: 140px;">
            <option value="">All Invoice Status</option>
            <option value="invoiced">âœ… Invoiced</option>
            <option value="not-invoiced">â³ Not Invoiced</option>
          </select>
        </div>
      </div>

      <!-- My Tours Table -->
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
          <h3>ğŸ“‹ My Tour Records</h3>
        </div>
        <div style="overflow-x: auto;">
          <table class="table">
            <thead>
              <tr>
                <th>Reg Date</th>
                <th>Tour Code</th>
                <th>Booking Code</th>
                <th>Lead Passenger</th>
                <th class="mt-staff-column" style="display:none;">Staff</th>
                <th>Pax</th>
                <th>Departure</th>
                <th>Status</th>
                <th>Invoice #</th>
                <th>Total Sales</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="mtToursTableBody">
              <tr><td colspan="11" class="text-center">Loading...</td></tr>
            </tbody>
          </table>
        </div>
        <div id="mtToursPagination" style="margin-top: 20px;"></div>
      </div>
    </div><!-- /tabMyTours -->

    <!-- TAB: Archived Tours -->
    <div id="tabArchivedTours" class="tab-content" style="display:none;">
      <!-- Summary Row -->
      <div class="at-summary-row">
        <div class="at-summary-item">
          <div class="at-summary-value" id="atTotalTours">0</div>
          <div class="at-summary-label">Archived Tours</div>
        </div>
        <div class="at-summary-item">
          <div class="at-summary-value" id="atTotalPassengers">0</div>
          <div class="at-summary-label">Total Passengers</div>
        </div>
        <div class="at-summary-item">
          <div class="at-summary-value" id="atTotalSales">Rp 0</div>
          <div class="at-summary-label">Total Sales</div>
        </div>
      </div>

      <!-- Search and Filter -->
      <div class="card" style="margin-top: 0; margin-bottom: 16px;">
        <div style="display: flex; gap: 12px; flex-wrap: wrap; align-items: center;">
          <input type="text" id="atSearchInput" placeholder="ğŸ” Search archived tours..." style="flex: 1; min-width: 250px;" />
          <select id="atFilterRegion" style="min-width: 140px;"><option value="">All Regions</option></select>
          <select id="atFilterStaff" style="min-width: 140px;"><option value="">All Staff</option></select>
        </div>
      </div>

      <!-- Archived Tours Table -->
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px">
          <h3>ğŸ“¦ Archived Tours (2025 & Earlier)</h3>
          <button id="archiveTours2025BtnTab" class="btn btn-secondary" style="display:none;" title="Archive remaining 2025 tours">ğŸ“¦ Archive 2025</button>
        </div>
        <div style="overflow-x: auto;">
          <table class="table">
            <thead>
              <tr>
                <th>Tour Code</th>
                <th>Registration</th>
                <th>Departure</th>
                <th>Region</th>
                <th>Lead Passenger</th>
                <th>Pax</th>
                <th>Status</th>
                <th>Staff</th>
                <th>Sales Amount</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="atToursTableBody">
              <tr><td colspan="10" class="text-center">Loading...</td></tr>
            </tbody>
          </table>
        </div>
        <div id="atToursPagination" style="margin-top: 20px;"></div>
      </div>

      <div class="card" style="margin-top: 16px; padding: 16px; background: var(--bg-subtle); border-radius: 8px; text-align: center; color: var(--text-secondary);">
        <strong>ğŸ“‹ Read Only</strong> â€” Archived tours from 2025 and earlier cannot be edited or deleted. They are preserved for historical records.
      </div>
    </div><!-- /tabArchivedTours -->

  </main>
</div>

<div id="modal" class="modal">
  <div class="modal-card">
    <div class="modal-header">
      <div id="modalTitle" class="modal-title"></div>
      <button type="button" class="modal-close" id="modalClose">&times;</button>
    </div>
    <form id="modalForm" class="modal-form" novalidate autocomplete="off">
      <div id="modalBody" class="modal-body"></div>
      <div class="modal-footer">
        <button type="button" id="modalCancel" class="btn btn-secondary">Cancel</button>
        <button type="submit" id="modalSave" class="btn btn-primary">Save</button>
      </div>
    </form>
  </div>
</div>

<script src="/js/toast.js"></script>
<script src="/js/utils.js"></script>
<script src="/js/confirm-dialog.js"></script>
<script src="/js/accessibility.js"></script>
<script src="/js/mobile-menu.js"></script>
<script src="/js/table-enhancer.js"></script>
<script src="/js/filter-manager.js"></script>
<script src="/js/chart-enhancer.js"></script>
<script src="/js/quick-view.js"></script>
<script src="/js/dashboard-customizer.js"></script>
<script src="/js/advanced-search.js"></script>
<script src="/js/enhanced-search-filter.js"></script>
<script src="/js/form-builder.js"></script>
<script src="/js/form-validator.js"></script>
<script src="/js/crud-modal.js"></script>
<script src="/js/tour-wizard.js"></script>
<script type="module" src="/js/auth-common.js"></script>
<script src="/js/logout-handler.js"></script>
<script src="/js/dashboard.js"></script>
<script type="module" src="/js/tours-dashboard.js"></script>
<script src="/js/app-enhancements.js"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    try {
      const token = localStorage.getItem('token');
      if (token) {
        const payload = JSON.parse(atob(token.split('.')[1]));
        if (payload.type === 'admin') {
          const adminLink = document.getElementById('adminSettingsLink');
          if (adminLink) adminLink.style.display = 'block';
        }
      }
    } catch (e) {}
  });
</script>
<script src="/js/sidebar-enhancements.js"></script>
<script src="/js/table-export.js"></script>
<script src="/js/keyboard-shortcuts.js"></script>

<!-- New Enhancement Modules -->
<script src="/js/global-search.js"></script>
<script src="/js/tour-calendar.js"></script>
<script src="/js/bulk-importer.js"></script>
<script src="/js/data-exporter.js"></script>
<script src="/js/audit-trail.js"></script>
<script src="/js/i18n.js"></script>
<script src="/js/ui-enhancements.js"></script>
<script src="/js/undo-manager.js"></script>
<script src="/js/form-dirty-state.js"></script>
<script src="/js/security-utils.js"></script>
<script src="/js/ui-extras.js"></script>
<script src="/js/auto-save.js"></script>
<script src="/js/error-recovery.js"></script>
<script src="/js/inline-editor.js"></script>
<script src="/js/smart-defaults.js"></script>
<script src="/js/bulk-actions.js"></script>

<!-- Additional Feature Modules -->
<script src="/js/saved-filters.js"></script>
<script src="/js/pwa-install.js"></script>
<script src="/js/keyboard-help.js"></script>

<script src="/js/pdf-export.js"></script>
<script src="/js/customer-database.js"></script>
<script src="/js/batch-status.js"></script>
<script src="/js/commission-calculator.js"></script>

<!-- Management & Reporting Modules -->
<script src="/js/advanced-reporting.js"></script>
<script src="/js/staff-management.js"></script>
<script src="/js/dashboard-analytics.js"></script>
<script src="/js/sidebar-groups.js"></script>
<script src="/js/error-monitoring.js"></script>
<script src="/js/api-cache.js"></script>
<script src="/js/breadcrumb-nav.js"></script>
<script src="/js/lazy-loader.js"></script>
</body>
</html>
