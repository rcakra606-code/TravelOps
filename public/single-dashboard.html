<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="theme-color" content="#0f62fe">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="manifest" href="/manifest.json">
<link rel="apple-touch-icon" href="/images/icon-192.png">
<title>TravelOps web</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/modern-normalize/1.1.0/modern-normalize.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/css/styles.css">
<link rel="stylesheet" href="/css/dark-mode.css">
<link rel="stylesheet" href="/css/app-v2.css">
<link rel="stylesheet" href="/css/dashboard.css">
<link rel="stylesheet" href="/css/modal.css">
<link rel="stylesheet" href="/css/filters.css">
<link rel="stylesheet" href="/css/table-enhancements.css">
<link rel="stylesheet" href="/css/filter-enhancements.css">
<link rel="stylesheet" href="/css/status-badges.css">
<link rel="stylesheet" href="/css/animations.css">
<link rel="stylesheet" href="/css/mobile-responsive.css">
<link rel="stylesheet" href="/css/dashboard-customization.css">
<link rel="stylesheet" href="/css/empty-states.css">
<link rel="stylesheet" href="/css/form-enhancements.css">
<link rel="stylesheet" href="/css/crud-enhancements.css">
<link rel="stylesheet" href="/css/filter-modal.css">
<link rel="stylesheet" href="/css/ui-enhancements.css">
<link rel="stylesheet" href="/css/sidebar-groups.css">
<link rel="stylesheet" href="/css/dashboard-shared.css">
<link rel="stylesheet" href="/css/accessibility.css">
<link rel="stylesheet" href="/css/professional-polish.css">
<link rel="stylesheet" href="/css/micro-interactions.css">
<script src="/js/theme-toggle.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
<button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle menu">â˜°</button>
<div class="mobile-overlay" id="mobileOverlay"></div>
<button class="dark-mode-toggle" id="darkModeToggle" aria-label="Toggle dark mode">ğŸŒ™</button>
<div class="app">
  <aside class="sidebar">
    <div class="brand">ğŸš€ TravelOps</div>
    <div class="nav" id="mainNav">
      <!-- Main Dashboard -->
      <button data-section="summary" class="nav-main-item active">ğŸ  Dashboard</button>
      
      <!-- Product Input Group -->
      <div class="nav-group" id="groupProductInput">
        <button class="nav-group-header" data-group="product-input">
          <span class="group-icon">ğŸ“¦</span>
          <span class="group-title">Product Input</span>
          <span class="group-arrow">â–¼</span>
        </button>
        <div class="nav-group-items">
          <a href="/tours-dashboard.html">ğŸ§³ Tours</a>
          <a href="/my-tours.html">ğŸ“‹ My Tours</a>
          <a href="/documents-dashboard.html">ğŸ“„ Documents</a>
          <a href="/hotel-dashboard.html">ğŸ¨ Hotel</a>
          <a href="/cruise-dashboard.html">ğŸš¢ Cruise</a>
          <a href="/telecom-dashboard.html">ğŸ“ Telecom</a>
          <a href="/tracking-dashboard.html">ğŸ“¦ Tracking</a>
          <a href="/ticket-recap-dashboard.html">âœˆï¸ Ticket Recap</a>
        </div>
      </div>
      
      <!-- Productivity Group -->
      <div class="nav-group" id="groupProductivity">
        <button class="nav-group-header" data-group="productivity">
          <span class="group-icon">ğŸ“Š</span>
          <span class="group-title">Productivity</span>
          <span class="group-arrow">â–¼</span>
        </button>
        <div class="nav-group-items">
          <a href="/sales-targets-dashboard.html">ğŸ’° Sales Report</a>
          <a href="/overtime-dashboard.html">â° Overtime</a>
          <a href="/productivity-dashboard.html">ğŸ“ˆ Productivity</a>
          <a href="/reports-dashboard.html" id="reportsLink" style="display: none;">ğŸ“Š Reports</a>
        </div>
      </div>
      
      <!-- Corporate Group -->
      <div class="nav-group" id="groupCorporate">
        <button class="nav-group-header" data-group="corporate">
          <span class="group-icon">ğŸ¢</span>
          <span class="group-title">Corporate</span>
          <span class="group-arrow">â–¼</span>
        </button>
        <div class="nav-group-items">
          <a href="/corporate-dashboard.html">ğŸ“Š Corporate Dashboard</a>
        </div>
      </div>
      
      <!-- Administration Group -->
      <div class="nav-group" id="groupAdmin">
        <button class="nav-group-header" data-group="administration">
          <span class="group-icon">âš™ï¸</span>
          <span class="group-title">Administration</span>
          <span class="group-arrow">â–¼</span>
        </button>
        <div class="nav-group-items">
          <a href="/outstanding-dashboard.html">ğŸ“‹ Outstanding</a>
          <a href="/cashout-dashboard.html">ğŸ’¸ Cash Out</a>
          <a href="/admin-settings.html" id="adminSettingsLink" style="display: none;">âš™ï¸ Admin Settings</a>
        </div>
      </div>
      
      <hr class="nav-divider">
      <a href="/profile.html">ğŸ‘¤ Profile</a>
      <a id="logoutLink" href="/logout.html">ğŸšª Logout</a>
    </div>
    <div class="userbox" style="margin-top:18px">
      <div id="userName">â€”</div>
      <div id="userRole">â€”</div>
    </div>
  </aside>

  <main class="main">
    <div class="header">
      <div>
        <h2 id="pageTitle">Dashboard</h2>
        <div class="small" id="pageSubtitle">Ringkasan operasional</div>
      </div>
    </div>

   <section id="summary" class="card section active">
  <!-- === WELCOME MESSAGE === -->
  <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 40px; border-radius: 12px; color: white; margin-bottom: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
    <h1 style="margin: 0 0 8px 0; font-size: 32px; font-weight: 700;">Welcome to TravelOps! ğŸ‘‹</h1>
    <p style="margin: 0; font-size: 18px; opacity: 0.95;" id="welcomeMessage">Manage your travel business with ease</p>
  </div>

  <!-- === QUICK NAVIGATION === -->
  <div style="margin-bottom: 24px;">
    <h3 style="margin: 0 0 16px 0; font-size: 18px; color: var(--text-primary);">ğŸš€ Quick Navigation</h3>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
      <a href="/sales-targets-dashboard.html" style="text-decoration: none;">
        <div style="background: var(--card); border: 2px solid var(--border-light); border-radius: 12px; padding: 24px; text-align: center; transition: all 0.3s; cursor: pointer;" onmouseover="this.style.borderColor='#3b82f6'; this.style.transform='translateY(-2px)';" onmouseout="this.style.borderColor='var(--border-light)'; this.style.transform='translateY(0)';">
          <div style="font-size: 40px; margin-bottom: 12px;">ğŸ’°</div>
          <div style="font-size: 16px; font-weight: 600; color: var(--text-primary);">Sales</div>
        </div>
      </a>
      
      <a href="/tours-dashboard.html" style="text-decoration: none;">
        <div style="background: var(--card); border: 2px solid var(--border-light); border-radius: 12px; padding: 24px; text-align: center; transition: all 0.3s; cursor: pointer;" onmouseover="this.style.borderColor='#10b981'; this.style.transform='translateY(-2px)';" onmouseout="this.style.borderColor='var(--border-light)'; this.style.transform='translateY(0)';">
          <div style="font-size: 40px; margin-bottom: 12px;">ğŸ§³</div>
          <div style="font-size: 16px; font-weight: 600; color: var(--text-primary);">Tours</div>
        </div>
      </a>
      
      <a href="/documents-dashboard.html" style="text-decoration: none;">
        <div style="background: var(--card); border: 2px solid var(--border-light); border-radius: 12px; padding: 24px; text-align: center; transition: all 0.3s; cursor: pointer;" onmouseover="this.style.borderColor='#f59e0b'; this.style.transform='translateY(-2px)';" onmouseout="this.style.borderColor='var(--border-light)'; this.style.transform='translateY(0)';">
          <div style="font-size: 40px; margin-bottom: 12px;">ğŸ“„</div>
          <div style="font-size: 16px; font-weight: 600; color: var(--text-primary);">Documents</div>
        </div>
      </a>
      
      <a href="/productivity-dashboard.html" style="text-decoration: none;">
        <div style="background: var(--card); border: 2px solid var(--border-light); border-radius: 12px; padding: 24px; text-align: center; transition: all 0.3s; cursor: pointer;" onmouseover="this.style.borderColor='#8b5cf6'; this.style.transform='translateY(-2px)';" onmouseout="this.style.borderColor='var(--border-light)'; this.style.transform='translateY(0)';">
          <div style="font-size: 40px; margin-bottom: 12px;">ğŸ“ˆ</div>
          <div style="font-size: 16px; font-weight: 600; color: var(--text-primary);">Productivity</div>
        </div>
      </a>
      
      <a href="/hotel-dashboard.html" style="text-decoration: none;">
        <div style="background: var(--card); border: 2px solid var(--border-light); border-radius: 12px; padding: 24px; text-align: center; transition: all 0.3s; cursor: pointer;" onmouseover="this.style.borderColor='#ec4899'; this.style.transform='translateY(-2px)';" onmouseout="this.style.borderColor='var(--border-light)'; this.style.transform='translateY(0)';">
          <div style="font-size: 40px; margin-bottom: 12px;">ğŸ¨</div>
          <div style="font-size: 16px; font-weight: 600; color: var(--text-primary);">Hotel</div>
        </div>
      </a>
      
      <a href="/cruise-dashboard.html" style="text-decoration: none;">
        <div style="background: var(--card); border: 2px solid var(--border-light); border-radius: 12px; padding: 24px; text-align: center; transition: all 0.3s; cursor: pointer;" onmouseover="this.style.borderColor='#06b6d4'; this.style.transform='translateY(-2px)';" onmouseout="this.style.borderColor='var(--border-light)'; this.style.transform='translateY(0)';">
          <div style="font-size: 40px; margin-bottom: 12px;">ğŸš¢</div>
          <div style="font-size: 16px; font-weight: 600; color: var(--text-primary);">Cruise</div>
        </div>
      </a>
    </div>
  </div>
</section>

    <!-- Sales -->
    <section id="sales" class="card section">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3>Sales</h3>
        <div>
          <button id="addSalesBtn" class="btn primary">+ Add Sales</button>
          <button data-filter-entity="sales" class="btn">ğŸ” Filter</button>
          <button id="exportSales" class="btn">Export CSV</button>
          <button id="downloadSalesTemplate" class="btn">Download Template</button>
          <input id="importSalesFile" type="file" accept=".csv" class="hidden"/>
          <button id="importSalesBtn" class="btn">Import CSV</button>
        </div>
      </div>
      <div class="searchbar">
        <input id="salesSearch" placeholder="Search invoice / staff / status..." style="flex:1;padding:8px;border-radius:8px;border:1px solid #d1d5db">
        <select id="salesPageSize" data-pagesize-entity="sales">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
      <table class="table"><thead><tr>
        <th class="sortable" data-column="transaction_date">Date</th>
        <th class="sortable" data-column="invoice_no">Invoice</th>
        <th class="sortable" data-column="staff_name">Staff</th>
        <th class="sortable" data-column="sales_amount">Sales</th>
        <th class="sortable" data-column="profit_amount">Profit</th>
        <th>Action</th>
      </tr></thead><tbody id="tblSales"></tbody></table>
      <div class="pagination" id="salesPagination"></div>
    </section>

    <!-- Tours -->
    <section id="tours" class="card section">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3>Tours</h3>
        <div>
          <button id="addTourBtn" class="btn primary">+ Add Tour</button>
          <button data-filter-entity="tours" class="btn">ğŸ” Filter</button>
          <button id="exportTours" class="btn">Export CSV</button>
          <button id="downloadToursTemplate" class="btn">Download Template</button>
          <input id="importToursFile" type="file" accept=".csv" class="hidden"/>
          <button id="importToursBtn" class="btn">Import CSV</button>
        </div>
      </div>
            <div class="searchbar">
        <input id="toursSearch" placeholder="Search code / staff / region..." style="flex:1;padding:8px;border-radius:8px;border:1px solid #d1d5db">
        <select id="toursPageSize" data-pagesize-entity="tours">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
      <div class="table-scroll-wrapper">
        <table class="table table-compact"><thead><tr>
          <th class="sortable" data-column="registration_date">Reg</th>
          <th class="sortable" data-column="tour_code">Code</th>
          <th class="sortable" data-column="booking_code">Booking</th>
          <th class="sortable" data-column="jumlah_peserta">Pax</th>
          <th class="sortable" data-column="departure_date">Depart</th>
          <th class="sortable" data-column="region_id">Region</th>
          <th class="sortable" data-column="status">Status</th>
          <th class="sortable" data-column="lead_passenger">Lead</th>
          <th class="sortable" data-column="total_nominal_sales">Total</th>
          <th class="sortable" data-column="staff_name">Staff</th>
          <th>Actions</th>
        </tr></thead><tbody id="tblTours"></tbody></table>
      </div>
      <div class="pagination" id="toursPagination"></div>
    </section>

    <!-- Documents -->
    <section id="documents" class="card section">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3>Documents</h3>
        <div>
          <button id="addDocBtn" class="btn primary">+ Add Document</button>
          <button data-filter-entity="documents" class="btn">ğŸ” Filter</button>
          <button id="exportDocs" class="btn">Export CSV</button>
          <button id="downloadDocsTemplate" class="btn">Download Template</button>
          <input id="importDocsFile" type="file" accept=".csv" class="hidden"/>
          <button id="importDocsBtn" class="btn">Import CSV</button>
        </div>
      </div>
      <div class="searchbar">
        <input id="documentsSearch" placeholder="Search name / passport / booking..." style="flex:1;padding:8px;border-radius:8px;border:1px solid #d1d5db">
        <select id="docsPageSize" data-pagesize-entity="documents">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
      <table class="table"><thead><tr>
        <th class="sortable" data-column="receive_date">Receive</th>
        <th class="sortable" data-column="guest_name">Guest</th>
        <th class="sortable" data-column="process_type">Process</th>
        <th class="sortable" data-column="staff_name">Staff</th>
        <th>Action</th>
      </tr></thead><tbody id="tblDocs"></tbody></table>
      <div class="pagination" id="docsPagination"></div>
    </section>

    <!-- Targets -->
    <section id="targets" class="card section">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3>Targets</h3>
        <div>
          <button id="addTargetBtn" class="btn primary">+ Add Target</button>
          <button data-filter-entity="targets" class="btn">ğŸ” Filter</button>
          <button id="exportTargets" class="btn">Export CSV</button>
          <button id="downloadTargetsTemplate" class="btn">Download Template</button>
          <input id="importTargetsFile" type="file" accept=".csv" class="hidden"/>
          <button id="importTargetsBtn" class="btn">Import CSV</button>
        </div>
      </div>
      <div class="searchbar">
        <input id="targetsSearch" placeholder="Search staff / month / year..." style="flex:1;padding:8px;border-radius:8px;border:1px solid #d1d5db">
        <select id="targetsPageSize" data-pagesize-entity="targets">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
      <table class="table"><thead><tr>
        <th class="sortable" data-column="month">Month</th>
        <th class="sortable" data-column="year">Year</th>
        <th class="sortable" data-column="staff_name">Staff</th>
        <th class="sortable" data-column="target_sales">Target Sales</th>
        <th class="sortable" data-column="target_profit">Target Profit</th>
        <th>Action</th>
      </tr></thead>
      <tbody id="tblTargets"></tbody></table>
      <div class="pagination" id="targetsPagination"></div>
    </section>

<section id="activity" class="section">
  <div class="controls"><h3>Activity History</h3></div>
  <div class="card">
    <table>
      <thead>
        <tr>
          <th>Time</th>
          <th>User</th>
          <th>Action</th>
          <th>Entity</th>
          <th>ID</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody id="tblActivity"></tbody>
    </table>
  </div>
</section>


    <!-- Telecom -->
    <section id="telecom" class="card section">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3>Telecom</h3>
        <div>
          <button id="addTelecomBtn" class="btn primary">+ Add Telecom</button>
          <button data-filter-entity="telecom" class="btn">ğŸ” Filter</button>
          <button id="exportTelecom" class="btn">Export CSV</button>
        </div>
      </div>
      <div class="searchbar">
        <input id="telecomSearch" placeholder="Search name / phone / type..." style="flex:1;padding:8px;border-radius:8px;border:1px solid #d1d5db">
        <select id="telecomPageSize" data-pagesize-entity="telecom">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
      <table class="table">
        <thead>
          <tr>
            <th class="sortable" data-column="nama">Name</th>
            <th class="sortable" data-column="no_telephone">Phone Number</th>
            <th class="sortable" data-column="type_product">Product Type</th>
            <th class="sortable" data-column="region_id">Country</th>
            <th class="sortable" data-column="tanggal_mulai">Start</th>
            <th class="sortable" data-column="tanggal_selesai">End</th>
            <th class="sortable" data-column="staff_name">Staff</th>
            <th class="sortable" data-column="deposit">Deposit</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="tblTelecom"></tbody>
      </table>
      <div class="pagination" id="telecomPagination"></div>
    </section>

    <!-- Hotel Bookings -->
    <section id="hotel_bookings" class="card section">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3>Hotel Bookings</h3>
        <div>
          <button id="addHotelBookingBtn" class="btn primary">+ Add Booking</button>
          <button data-filter-entity="hotel_bookings" class="btn">ğŸ” Filter</button>
          <button id="exportHotelBookings" class="btn">Export CSV</button>
        </div>
      </div>
      <div class="searchbar">
        <input id="hotelBookingsSearch" placeholder="Search hotel / guest / confirmation..." style="flex:1;padding:8px;border-radius:8px;border:1px solid #d1d5db">
        <select id="hotelBookingsPageSize" data-pagesize-entity="hotel_bookings">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
      <table class="table">
        <thead>
          <tr>
            <th class="sortable" data-column="check_in">Check In</th>
            <th class="sortable" data-column="check_out">Check Out</th>
            <th class="sortable" data-column="hotel_name">Hotel</th>
            <th class="sortable" data-column="region_id">Region</th>
            <th class="sortable" data-column="confirmation_number">Confirmation</th>
            <th class="sortable" data-column="guest_list">Guest List</th>
            <th class="sortable" data-column="staff_name">Staff</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody id="tblHotelBookings"></tbody>
      </table>
      <div class="pagination" id="hotelBookingsPagination"></div>
    </section>

    <!-- Profile -->
    <section id="profile" class="section">
      <div class="profile-container">
        <!-- Profile Header Card -->
        <div class="card profile-header">
          <div class="profile-avatar">
            <div class="avatar-circle">
              <span id="profileInitials">?</span>
            </div>
          </div>
          <div class="profile-info">
            <h2 id="profileName">Loading...</h2>
            <p class="profile-role" id="profileRole">-</p>
            <p class="profile-username" id="profileUsername">@username</p>
          </div>
        </div>

        <!-- Profile Details Card -->
        <div class="card profile-details">
          <h3>Informasi Akun</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Username</label>
              <div id="detailUsername">-</div>
            </div>
            <div class="detail-item">
              <label>Nama Lengkap</label>
              <div id="detailName">-</div>
            </div>
            <div class="detail-item">
              <label>Email</label>
              <div id="detailEmail">-</div>
            </div>
            <div class="detail-item">
              <label>Tipe Akun</label>
              <div id="detailType">-</div>
            </div>
          </div>
        </div>

        <!-- Change Password Card -->
        <div class="card profile-password">
          <h3>Change Password</h3>
          <p class="small" style="margin-bottom: 16px; color: #6b7280;">
            Password must be at least 8 characters and contain uppercase, lowercase letters, and numbers.
          </p>
          <form id="pwForm">
            <div class="form-group">
              <label>New Password</label>
              <input type="password" name="password" required minlength="8" pattern="(?=.*[a-z])(?=.*[A-Z])(?=.*\\d).{8,}" placeholder="Min 8: upper, lower & number">
            </div>
            <div class="form-group">
              <label>Confirm Password</label>
              <input type="password" name="password_confirm" required minlength="8" pattern="(?=.*[a-z])(?=.*[A-Z])(?=.*\\d).{8,}" placeholder="Re-type new password">
            </div>
            <button class="btn btn-primary" type="submit">
              <span>ğŸ”’</span> Change Password
            </button>
          </form>
        </div>

        <!-- Activity Summary (if admin) -->
        <div class="card profile-stats" id="profileStats" style="display: none;">
          <h3>Activity Statistics</h3>
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-value" id="statSales">0</div>
              <div class="stat-label">Total Sales</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="statTours">0</div>
              <div class="stat-label">Total Tours</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="statDocs">0</div>
              <div class="stat-label">Total Documents</div>
            </div>
          </div>
        </div>

        <!-- Email Notification Testing (Admin Only) -->
        <div class="card" id="emailTestingPanel" style="display: none;">
          <h3 style="margin-top: 0; color: #2563eb; display: flex; align-items: center; gap: 8px;">
            <span style="font-size: 24px;">ğŸ“§</span>
            Email Notification System
          </h3>
          
          <div id="emailConfigStatus" style="padding: 16px; border-radius: 8px; margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
            <span id="emailStatusIcon" style="font-size: 24px;"></span>
            <div>
              <strong id="emailStatusTitle">Checking configuration...</strong>
              <p id="emailStatusMessage" style="margin: 4px 0 0 0; color: #6b7280; font-size: 0.9rem;"></p>
            </div>
          </div>

          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; margin-bottom: 24px;">
            <!-- Test Email Card -->
            <div style="background: #f9fafb; padding: 20px; border-radius: 12px; border: 1px solid #e5e7eb;">
              <h4 style="margin-top: 0; color: #1f2937; font-size: 16px; display: flex; align-items: center; gap: 8px;">
                <span>âœ‰ï¸</span> Test Email
              </h4>
              <p style="color: #6b7280; font-size: 0.9rem; margin-bottom: 16px;">
                Send a test email to verify SMTP configuration
              </p>
              <div style="margin-bottom: 12px;">
                <input 
                  type="email" 
                  id="testEmailInput" 
                  placeholder="recipient@example.com"
                  style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 0.95rem;"
                />
              </div>
              <button 
                id="sendTestEmailBtn" 
                class="btn primary" 
                style="width: 100%;"
              >
                Send Test Email
              </button>
            </div>

            <!-- Manual Trigger Card -->
            <div style="background: #fef3c7; padding: 20px; border-radius: 12px; border: 1px solid #fbbf24;">
              <h4 style="margin-top: 0; color: #92400e; font-size: 16px; display: flex; align-items: center; gap: 8px;">
                <span>âš¡</span> Trigger Reminders
              </h4>
              <p style="color: #78350f; font-size: 0.9rem; margin-bottom: 16px;">
                Manually check and send departure reminders now
              </p>
              <button 
                id="triggerRemindersBtn" 
                class="btn" 
                style="width: 100%; background: #f59e0b; color: white;"
              >
                Trigger Now
              </button>
              <p style="margin-top: 12px; font-size: 0.85rem; color: #78350f;">
                <strong>Note:</strong> Automated schedule runs daily at 9:00 AM
              </p>
            </div>

            <!-- Reminder Stats Card -->
            <div style="background: #ecfdf5; padding: 20px; border-radius: 12px; border: 1px solid #10b981;">
              <h4 style="margin-top: 0; color: #065f46; font-size: 16px; display: flex; align-items: center; gap: 8px;">
                <span>ğŸ“Š</span> Statistics
              </h4>
              <p style="color: #047857; font-size: 0.9rem; margin-bottom: 16px;">
                View sent reminder statistics
              </p>
              <button 
                id="viewStatsBtn" 
                class="btn" 
                style="width: 100%; background: #10b981; color: white;"
              >
                View Stats
              </button>
            </div>
          </div>

          <!-- Results Display -->
          <div id="emailTestResults" style="display: none; margin-top: 20px;"></div>

          <!-- Stats Table -->
          <div id="emailStatsTable" style="display: none; margin-top: 20px;">
            <h4 style="color: #1f2937; margin-bottom: 12px;">Recent Reminder Activity</h4>
            <div style="overflow-x: auto;">
              <table class="table">
                <thead>
                  <tr>
                    <th>Days Before</th>
                    <th>Count</th>
                    <th>Date Sent</th>
                  </tr>
                </thead>
                <tbody id="statsTableBody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </section>

  </main>
</div>

<!-- Enhanced Modal -->
<div id="modal" class="modal">
  <div class="modal-card">
    <div class="modal-header">
      <div id="modalTitle" class="modal-title"></div>
      <button type="button" class="modal-close" id="modalClose">&times;</button>
    </div>
    <form id="modalForm" class="modal-form">
      <div id="modalBody" class="modal-body"></div>
      <div class="modal-footer">
        <button type="button" id="modalCancel" class="btn btn-secondary">Cancel</button>
        <button type="submit" id="modalSave" class="btn btn-primary">Save</button>
      </div>
    </form>
  </div>
</div>

<!-- Load shared auth module first to provide fetchJson & token management -->
<script src="/js/toast.js"></script>
<script src="/js/utils.js"></script>
<script src="/js/confirm-dialog.js"></script>
<script src="/js/accessibility.js"></script>
<script src="/js/mobile-menu.js"></script>
<script src="/js/table-enhancer.js"></script>
<script src="/js/filter-manager.js"></script>
<script src="/js/chart-enhancer.js"></script>
<script src="/js/quick-view.js"></script>
<script src="/js/dashboard-customizer.js"></script>
<script src="/js/advanced-search.js"></script>
<script src="/js/enhanced-search-filter.js"></script>
<script src="/js/form-builder.js"></script>
<script src="/js/form-validator.js"></script>
<script src="/js/crud-modal.js"></script>
<script type="module" src="/js/auth-common.js"></script>
<script src="/js/logout-handler.js"></script>
<!-- Dashboard logic (now relies on auth-common for auth utilities) -->
<script src="/js/dashboard.js?v=9"></script>
<script defer src="/js/crud-handlers.js?v=7"></script>

<!-- Service Worker Registration (external to comply with CSP) -->
<script src="/js/sw-register.js"></script>

<!-- App Enhancements: Auto-refresh, Notifications, Error Handling -->
<script src="/js/app-enhancements.js"></script>

<!-- Removed logout confirmation modal; using direct navigation to /logout.html -->

<script>
  document.addEventListener('DOMContentLoaded', () => {
    try {
      const token = localStorage.getItem('token');
      if (token) {
        const payload = JSON.parse(atob(token.split('.')[1]));
        if (payload.type === 'admin') {
          const adminLink = document.getElementById('adminSettingsLink');
          if (adminLink) adminLink.style.display = 'block';
        }
      }
    } catch (e) {}
  });
</script>
<script src="/js/sidebar-enhancements.js"></script>
<script src="/js/table-export.js"></script>
<script src="/js/keyboard-shortcuts.js"></script>

<!-- New Enhancement Modules -->
<script src="/js/global-search.js"></script>
<script src="/js/tour-calendar.js"></script>
<script src="/js/yoy-analytics.js"></script>
<script src="/js/bulk-importer.js"></script>
<script src="/js/dashboard-widgets.js"></script>
<script src="/js/audit-trail.js"></script>
<script src="/js/i18n.js"></script>
<script src="/js/data-exporter.js"></script>
<script src="/js/ui-enhancements.js"></script>

<!-- UX Enhancements -->
<script src="/js/undo-manager.js"></script>
<script src="/js/form-dirty-state.js"></script>
<script src="/js/security-utils.js"></script>
<script src="/js/ui-extras.js"></script>
<script src="/js/auto-save.js"></script>
<script src="/js/error-recovery.js"></script>
<script src="/js/recent-items.js"></script>
<script src="/js/inline-editor.js"></script>
<script src="/js/smart-defaults.js"></script>
<script src="/js/bulk-actions.js"></script>
<!-- Additional Feature Modules -->
<script src="/js/saved-filters.js"></script>
<script src="/js/pwa-install.js"></script>
<script src="/js/keyboard-help.js"></script>

<script src="/js/pdf-export.js"></script>
<script src="/js/customer-database.js"></script>
<script src="/js/batch-status.js"></script>
<script src="/js/activity-feed.js"></script>
<script src="/js/dashboard-analytics.js"></script>
<script src="/js/sidebar-groups.js"></script>
<script src="/js/error-monitoring.js"></script>
<script src="/js/api-cache.js"></script>
<script src="/js/breadcrumb-nav.js"></script>
<script src="/js/lazy-loader.js"></script>
</body>
</html>
