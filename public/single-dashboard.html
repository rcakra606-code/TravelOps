<!doctype html>
<html lang="id">
<head>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>TravelOps web</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/modern-normalize/1.1.0/modern-normalize.min.css" />
<link rel="stylesheet" href="/css/styles.css">
<link rel="stylesheet" href="/css/modal.css">
<link rel="stylesheet" href="/css/dashboard.css">
</head>
<body>
<div class="app">
  <aside class="sidebar">
    <div class="brand">üöÄ TravelOps</div>
    <div class="nav" id="mainNav">
      <button data-section="summary" class="active">üè† Dashboard</button>
      <button data-section="sales">üí∞ Sales</button>
      <button data-section="tours">üß≥ Tours</button>
      <button data-section="documents">üìÑ Documents</button>
      <button data-section="targets">üéØ Targets</button>
      <button data-section="telecom">üìû Telecom</button>
      <button data-section="hotel_bookings">üè® Hotel Bookings</button>
      <button data-section="regions">üåç Regions</button>
      <button data-section="users">üë• Users</button>
  <button data-section="profile">‚öôÔ∏è Profile</button>
  <a id="logoutLink" href="/logout.html">üö™ Logout</a>
    </div>
    <div class="userbox" style="margin-top:18px">
      <div id="userName">‚Äî</div>
      <div id="userRole">‚Äî</div>
    </div>
  </aside>

  <main class="main">
    <div class="header">
      <div>
        <h2 id="pageTitle">Dashboard</h2>
        <div class="small" id="pageSubtitle">Ringkasan operasional</div>
      </div>
      <div class="controls">
        <div class="filter-row" style="margin:0; align-items: center;">
          <!-- Specialized Dashboard Links -->
          <div style="display: flex; gap: 8px; margin-right: 16px;">
            <a href="/sales-dashboard.html" class="btn" style="text-decoration: none; padding: 8px 16px;">üí∞ Sales Dashboard</a>
            <a href="/tours-dashboard.html" class="btn" style="text-decoration: none; padding: 8px 16px;">üß≥ Tours Dashboard</a>
            <a href="/documents-dashboard.html" class="btn" style="text-decoration: none; padding: 8px 16px;">üìÑ Documents Dashboard</a>
          </div>
          
          <!-- Filters -->
          <label class="small">Staff:</label>
          <select id="filterStaff"><option value="all">Semua</option></select>
          <label class="small">Periode:</label>
          <select id="filterPeriod"><option value="all">Keseluruhan</option><option value="month">Per Bulan</option><option value="year">Per Tahun</option></select>
          <input id="filterMonth" type="month" style="display:none">
          <input id="filterYear" type="number" placeholder="Tahun" min="2000" max="2100" style="width:100px;display:none">
          <label class="small">Region:</label>
          <select id="filterRegion"><option value="all">Semua</option></select>
          <button id="applyFilters" class="btn">Terapkan</button>
        </div>
      </div>
    </div>

   <section id="summary" class="card section active">
  <!-- === METRICS TOP ROW === -->

<!-- === GLOBAL FILTER === -->
<!-- Removed obsolete global filter bar; per-entity modal filtering now in use -->

  <div class="dashboard-metrics">
    <div class="metric-card" id="metricSales">
      <div class="metric-title">Sales</div>
      <div class="metric-value" id="totalSales">Rp 0</div>
      <div class="metric-subtitle" id="salesAchievement">-</div>
    </div>

    <div class="metric-card" id="metricProfit">
      <div class="metric-title">Profit</div>
      <div class="metric-value" id="totalProfit">Rp 0</div>
      <div class="metric-subtitle" id="profitAchievement">-</div>
    </div>

    <div class="metric-card" id="metricParticipants">
      <div class="metric-title">Total Peserta</div>
      <div class="metric-value" id="totalParticipants">0</div>
      <div class="metric-subtitle">Per bulan / per region di bawah</div>
    </div>

    <div class="metric-card" id="metricDocs">
      <div class="metric-title">Dokumen Masuk</div>
      <div class="metric-value" id="totalDocs">0</div>
      <div class="metric-subtitle">Per proses & per region di bawah</div>
    </div>

    <div style="text-align:right; margin-bottom:10px;">
     <button id="exportDashboardCSV" class="btn">‚¨á Export Dashboard CSV</button>
    </div>
  </div>

  <!-- === SALES / PROFIT CHARTS === -->
  <div class="chart-container">
    <div class="chart-header">
      <div class="chart-title">Sales vs Target Sales</div>
    </div>
    <canvas id="chartSalesTarget" class="chart-sales-target"></canvas>
  </div>

  <div class="chart-container">
    <div class="chart-header">
      <div class="chart-title">Profit vs Target Profit</div>
    </div>
    <canvas id="chartProfitTarget" class="chart-profit-target"></canvas>
  </div>

  <!-- === PESERTA === -->
  <div class="chart-container">
    <div class="chart-header">
      <div class="chart-title">Peserta per Bulan Keberangkatan</div>
    </div>
    <canvas id="chartParticipantMonth" class="chart-participants"></canvas>
  </div>

  <div class="chart-container">
    <div class="chart-header">
      <div class="chart-title">Peserta per Region</div>
    </div>
    <canvas id="chartParticipantRegion" class="chart-participants"></canvas>
  </div>

  <!-- === DOKUMEN === -->
  <div class="chart-container">
    <div class="chart-header">
      <div class="chart-title">Dokumen ‚Äî by Process (Normal vs Kilat)</div>
    </div>
    <canvas id="chartDocType" class="chart-documents"></canvas>
  </div>

  <div class="chart-container">
    <div class="chart-header">
      <div class="chart-title">Dokumen ‚Äî by Region</div>
    </div>
    <canvas id="chartDocsRegion" class="chart-documents"></canvas>
  </div>

  <div class="chart-container">
    <div class="chart-header">
      <div class="chart-title">Dokumen ‚Äî by Bulan (Receive Date)</div>
    </div>
    <canvas id="chartDocsMonth" class="chart-documents"></canvas>
  </div>
</section>

    <!-- Sales -->
    <section id="sales" class="card section">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3>Sales</h3>
        <div>
          <button id="addSalesBtn" class="btn primary">+ Tambah Sales</button>
          <button data-filter-entity="sales" class="btn">üîç Filter</button>
          <button id="exportSales" class="btn">Export CSV</button>
          <button id="downloadSalesTemplate" class="btn">Download Template</button>
          <input id="importSalesFile" type="file" accept=".csv" class="hidden"/>
          <button id="importSalesBtn" class="btn">Import CSV</button>
        </div>
      </div>
      <div class="searchbar">
        <select id="salesPageSize" data-pagesize-entity="sales" style="margin-left:auto">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
      <table class="table"><thead><tr>
        <th class="sortable" data-column="transaction_date">Tanggal</th>
        <th class="sortable" data-column="invoice_no">Invoice</th>
        <th class="sortable" data-column="staff_name">Staff</th>
        <th class="sortable" data-column="sales_amount">Sales</th>
        <th class="sortable" data-column="profit_amount">Profit</th>
        <th>Aksi</th>
      </tr></thead><tbody id="tblSales"></tbody></table>
      <div class="pagination" id="salesPagination"></div>
    </section>

    <!-- Tours -->
    <section id="tours" class="card section">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3>Tours</h3>
        <div>
          <button id="addTourBtn" class="btn primary">+ Tambah Tour</button>
          <button data-filter-entity="tours" class="btn">üîç Filter</button>
          <button id="exportTours" class="btn">Export CSV</button>
          <button id="downloadToursTemplate" class="btn">Download Template</button>
          <input id="importToursFile" type="file" accept=".csv" class="hidden"/>
          <button id="importToursBtn" class="btn">Import CSV</button>
        </div>
      </div>
            <div class="searchbar">
        <input id="toursSearch" placeholder="Cari code / staff / region..." style="flex:1;padding:8px;border-radius:8px;border:1px solid #d1d5db">
        <select id="toursPageSize" data-pagesize-entity="tours">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
      <table class="table"><thead><tr>
        <th class="sortable" data-column="registration_date">Reg</th>
        <th class="sortable" data-column="tour_code">Code</th>
        <th class="sortable" data-column="jumlah_peserta">Pax</th>
        <th class="sortable" data-column="departure_date">Depart</th>
        <th class="sortable" data-column="region_id">Region</th>
        <th class="sortable" data-column="staff_name">Staff</th>
        <th>Aksi</th>
      </tr></thead><tbody id="tblTours"></tbody></table>
      <div class="pagination" id="toursPagination"></div>
    </section>

    <!-- Documents -->
    <section id="documents" class="card section">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3>Documents</h3>
        <div>
          <button id="addDocBtn" class="btn primary">+ Tambah Document</button>
          <button data-filter-entity="documents" class="btn">üîç Filter</button>
          <button id="exportDocs" class="btn">Export CSV</button>
          <button id="downloadDocsTemplate" class="btn">Download Template</button>
          <input id="importDocsFile" type="file" accept=".csv" class="hidden"/>
          <button id="importDocsBtn" class="btn">Import CSV</button>
        </div>
      </div>
      <div class="searchbar">
        <select id="docsPageSize" data-pagesize-entity="documents" style="margin-left:auto">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
      <table class="table"><thead><tr>
        <th class="sortable" data-column="receive_date">Receive</th>
        <th class="sortable" data-column="guest_name">Guest</th>
        <th class="sortable" data-column="process_type">Process</th>
        <th class="sortable" data-column="staff_name">Staff</th>
        <th>Aksi</th>
      </tr></thead><tbody id="tblDocs"></tbody></table>
      <div class="pagination" id="docsPagination"></div>
    </section>

    <!-- Targets -->
    <section id="targets" class="card section">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3>Targets</h3>
        <div>
          <button id="addTargetBtn" class="btn primary">+ Tambah Target</button>
          <button data-filter-entity="targets" class="btn">üîç Filter</button>
          <button id="exportTargets" class="btn">Export CSV</button>
          <button id="downloadTargetsTemplate" class="btn">Download Template</button>
          <input id="importTargetsFile" type="file" accept=".csv" class="hidden"/>
          <button id="importTargetsBtn" class="btn">Import CSV</button>
        </div>
      </div>
      <div class="searchbar">
        <select id="targetsPageSize" data-pagesize-entity="targets" style="margin-left:auto">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
      <table class="table"><thead><tr>
        <th class="sortable" data-column="month">Bulan</th>
        <th class="sortable" data-column="year">Tahun</th>
        <th class="sortable" data-column="staff_name">Staff</th>
        <th class="sortable" data-column="target_sales">Target Sales</th>
        <th class="sortable" data-column="target_profit">Target Profit</th>
        <th>Aksi</th>
      </tr></thead>
      <tbody id="tblTargets"></tbody></table>
      <div class="pagination" id="targetsPagination"></div>
    </section>

    <!-- Regions -->
    <section id="regions" class="card section">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3>Regions</h3>
        <div>
          <button id="addRegionBtn" class="btn primary">+ Tambah Region</button>
          <button data-filter-entity="regions" class="btn">üîç Filter</button>
        </div>
      </div>
      <div class="searchbar">
        <select id="regionsPageSize" data-pagesize-entity="regions" style="margin-left:auto">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
      <table class="table"><thead><tr>
        <th class="sortable" data-column="id">ID</th>
        <th class="sortable" data-column="region_name">Region</th>
        <th>Aksi</th>
      </tr></thead><tbody id="tblRegions"></tbody></table>
      <div class="pagination" id="regionsPagination"></div>
    </section>

<section id="activity" class="section">
  <div class="controls"><h3>Riwayat Aktivitas</h3></div>
  <div class="card">
    <table>
      <thead>
        <tr>
          <th>Waktu</th>
          <th>User</th>
          <th>Aksi</th>
          <th>Entitas</th>
          <th>ID</th>
          <th>Keterangan</th>
        </tr>
      </thead>
      <tbody id="tblActivity"></tbody>
    </table>
  </div>
</section>


    <!-- Users -->
    <section id="users" class="card section">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3>Users</h3>
        <div>
          <button id="addUserBtn" class="btn primary">+ Tambah User</button>
          <button data-filter-entity="users" class="btn">üîç Filter</button>
        </div>
      </div>
      <div class="searchbar">
        <select id="usersPageSize" data-pagesize-entity="users" style="margin-left:auto">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
      <table class="table"><thead><tr>
        <th class="sortable" data-column="username">Username</th>
        <th class="sortable" data-column="name">Name</th>
        <th class="sortable" data-column="type">Type</th>
        <th>Aksi</th>
      </tr></thead><tbody id="tblUsers"></tbody></table>
      <div class="pagination" id="usersPagination"></div>
    </section>

    <!-- Telecom -->
    <section id="telecom" class="card section">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3>Telecom</h3>
        <div>
          <button id="addTelecomBtn" class="btn primary">+ Tambah Telecom</button>
          <button data-filter-entity="telecom" class="btn">üîç Filter</button>
          <button id="exportTelecom" class="btn">Export CSV</button>
        </div>
      </div>
      <div class="searchbar">
        <select id="telecomPageSize" data-pagesize-entity="telecom" style="margin-left:auto">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
      <table class="table">
        <thead>
          <tr>
            <th class="sortable" data-column="nama">Nama</th>
            <th class="sortable" data-column="no_telephone">No Telephone</th>
            <th class="sortable" data-column="type_product">Type Product</th>
            <th class="sortable" data-column="region_id">Negara</th>
            <th class="sortable" data-column="tanggal_mulai">Mulai</th>
            <th class="sortable" data-column="tanggal_selesai">Selesai</th>
            <th class="sortable" data-column="staff_name">Staff</th>
            <th class="sortable" data-column="deposit">Deposit</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="tblTelecom"></tbody>
      </table>
      <div class="pagination" id="telecomPagination"></div>
    </section>

    <!-- Hotel Bookings -->
    <section id="hotel_bookings" class="card section">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3>Hotel Bookings</h3>
        <div>
          <button id="addHotelBookingBtn" class="btn primary">+ Tambah Hotel Booking</button>
          <button data-filter-entity="hotel_bookings" class="btn">üîç Filter</button>
          <button id="exportHotelBookings" class="btn">Export CSV</button>
        </div>
      </div>
      <div class="searchbar">
        <select id="hotelBookingsPageSize" data-pagesize-entity="hotel_bookings" style="margin-left:auto">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
      <table class="table">
        <thead>
          <tr>
            <th class="sortable" data-column="check_in">Check In</th>
            <th class="sortable" data-column="check_out">Check Out</th>
            <th class="sortable" data-column="hotel_name">Hotel</th>
            <th class="sortable" data-column="region_id">Region</th>
            <th class="sortable" data-column="confirmation_number">Konfirmasi</th>
            <th class="sortable" data-column="guest_list">Guest List</th>
            <th class="sortable" data-column="staff_name">Staff</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="tblHotelBookings"></tbody>
      </table>
      <div class="pagination" id="hotelBookingsPagination"></div>
    </section>

    <!-- Profile -->
    <section id="profile" class="section">
      <div class="profile-container">
        <!-- Profile Header Card -->
        <div class="card profile-header">
          <div class="profile-avatar">
            <div class="avatar-circle">
              <span id="profileInitials">?</span>
            </div>
          </div>
          <div class="profile-info">
            <h2 id="profileName">Loading...</h2>
            <p class="profile-role" id="profileRole">-</p>
            <p class="profile-username" id="profileUsername">@username</p>
          </div>
        </div>

        <!-- Profile Details Card -->
        <div class="card profile-details">
          <h3>Informasi Akun</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Username</label>
              <div id="detailUsername">-</div>
            </div>
            <div class="detail-item">
              <label>Nama Lengkap</label>
              <div id="detailName">-</div>
            </div>
            <div class="detail-item">
              <label>Email</label>
              <div id="detailEmail">-</div>
            </div>
            <div class="detail-item">
              <label>Tipe Akun</label>
              <div id="detailType">-</div>
            </div>
          </div>
        </div>

        <!-- Change Password Card -->
        <div class="card profile-password">
          <h3>Ubah Password</h3>
          <p class="small" style="margin-bottom: 16px; color: #6b7280;">
            Password minimal 8 karakter dan harus mengandung huruf besar, huruf kecil, serta angka.
          </p>
          <form id="pwForm">
            <div class="form-group">
              <label>Password Baru</label>
              <input type="password" name="password" required minlength="8" pattern="(?=.*[a-z])(?=.*[A-Z])(?=.*\\d).{8,}" placeholder="Min 8: huruf besar, kecil & angka">
            </div>
            <div class="form-group">
              <label>Konfirmasi Password</label>
              <input type="password" name="password_confirm" required minlength="8" pattern="(?=.*[a-z])(?=.*[A-Z])(?=.*\\d).{8,}" placeholder="Ketik ulang password baru">
            </div>
            <button class="btn btn-primary" type="submit">
              <span>üîí</span> Ubah Password
            </button>
          </form>
        </div>

        <!-- Activity Summary (if admin) -->
        <div class="card profile-stats" id="profileStats" style="display: none;">
          <h3>Statistik Aktivitas</h3>
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-value" id="statSales">0</div>
              <div class="stat-label">Total Sales</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="statTours">0</div>
              <div class="stat-label">Total Tours</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="statDocs">0</div>
              <div class="stat-label">Total Dokumen</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="statTargets">0</div>
              <div class="stat-label">Total Targets</div>
            </div>
          </div>
        </div>
      </div>
    </section>

  </main>
</div>

<!-- Enhanced Modal -->
<div id="modal" class="modal">
  <div class="modal-card">
    <div class="modal-header">
      <div id="modalTitle" class="modal-title"></div>
      <button type="button" class="modal-close" id="modalClose">&times;</button>
    </div>
    <form id="modalForm" class="modal-form">
      <div id="modalBody" class="modal-body"></div>
      <div class="modal-footer">
        <button type="button" id="modalCancel" class="btn btn-secondary">Batal</button>
        <button type="submit" id="modalSave" class="btn btn-primary">Simpan</button>
      </div>
    </form>
  </div>
</div>

<!-- Load dashboard first (plain script exports globals immediately), then CRUD handlers -->
<script src="/js/dashboard.js?v=8"></script>
<script defer src="/js/crud-handlers.js?v=7"></script>

<!-- Removed logout confirmation modal; using direct navigation to /logout.html -->

</body>
</html>