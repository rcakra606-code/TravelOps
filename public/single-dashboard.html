<!doctype html>
<html lang="id">
<head>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<meta name="theme-color" content="#0f62fe">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="manifest" href="/manifest.json">
<link rel="apple-touch-icon" href="/images/icon-192.png">
<title>TravelOps web</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/modern-normalize/1.1.0/modern-normalize.min.css" />
<link rel="stylesheet" href="/css/styles.css">
<link rel="stylesheet" href="/css/dark-mode.css">
<link rel="stylesheet" href="/css/app-v2.css">
<link rel="stylesheet" href="/css/modal.css">
<link rel="stylesheet" href="/css/dashboard.css">
<link rel="stylesheet" href="/css/filters.css">
<link rel="stylesheet" href="/css/table-enhancements.css">
<link rel="stylesheet" href="/css/filter-enhancements.css">
<link rel="stylesheet" href="/css/status-badges.css">
<link rel="stylesheet" href="/css/animations.css">
<link rel="stylesheet" href="/css/mobile-responsive.css">
<link rel="stylesheet" href="/css/dashboard-customization.css">
<link rel="stylesheet" href="/css/empty-states.css">
<link rel="stylesheet" href="/css/form-enhancements.css">
<link rel="stylesheet" href="/css/crud-enhancements.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="/js/theme-toggle.js"></script>
<style>
  .comparison-btn {
    padding: 8px 16px;
    border: 1px solid var(--border-light);
    border-radius: 8px;
    background: var(--card);
    color: var(--text-secondary);
    cursor: pointer;
    transition: all 0.2s;
    font-size: 14px;
    font-weight: 500;
  }
  .comparison-btn:hover {
    background: var(--bg-alt);
    border-color: var(--primary);
  }
  .comparison-btn.active {
    background: var(--primary);
    color: white;
    border-color: var(--primary);
  }
  .metric-change {
    margin-top: 8px;
    padding: 4px 8px;
    border-radius: 4px;
    font-size: 12px;
    font-weight: 600;
  }
  .metric-change.positive {
    background: rgba(16, 185, 129, 0.2);
    color: #10b981;
  }
  .metric-change.negative {
    background: rgba(239, 68, 68, 0.2);
    color: #ef4444;
  }
  .leaderboard-rank {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 14px;
  }
  .leaderboard-rank.gold { background: linear-gradient(135deg, #fbbf24, #f59e0b); color: white; }
  .leaderboard-rank.silver { background: linear-gradient(135deg, #9ca3af, #6b7280); color: white; }
  .leaderboard-rank.bronze { background: linear-gradient(135deg, #d97706, #b45309); color: white; }
  .leaderboard-rank.normal { background: var(--bg-alt); color: var(--text-secondary); }
</style>
</head>
<body>
<button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle menu">â˜°</button>
<div class="mobile-overlay" id="mobileOverlay"></div>
<button class="dark-mode-toggle" id="darkModeToggle" aria-label="Toggle dark mode">ğŸŒ™</button>
<div class="app">
  <aside class="sidebar">
    <div class="brand">ğŸš€ TravelOps</div>
    <div class="nav" id="mainNav">
      <button data-section="summary" class="active">ğŸ  Dashboard</button>
      <a href="/sales-dashboard.html">ğŸ’° Sales</a>
      <a href="/tours-dashboard.html">ğŸ§³ Tours</a>
      <a href="/documents-dashboard.html">ğŸ“„ Documents</a>
      <a href="/targets-dashboard.html">ğŸ¯ Targets</a>
      <a href="/telecom-dashboard.html">ğŸ“ Telecom</a>
      <a href="/hotel-dashboard.html">ğŸ¨ Hotel Bookings</a>
      <a href="/overtime-dashboard.html">â° Overtime</a>
      <a href="/cruise-dashboard.html">ğŸš¢ Cruise</a>
      <a href="/outstanding-dashboard.html">ğŸ“‹ Outstanding</a>
      <hr style="margin: 12px 0; border: 1px solid #e5e7eb;">
      <button data-section="regions">ğŸŒ Regions</button>
      <button data-section="users">ğŸ‘¥ Users</button>
      <a href="/reports-dashboard.html" id="reportsLink" style="display: none;">ğŸ“Š Reports</a>
      <button data-section="admin" id="adminNavBtn" style="display: none;">ğŸ›¡ï¸ Admin</button>
      <button data-section="profile">âš™ï¸ Profile</button>
      <a id="logoutLink" href="/logout.html">ğŸšª Logout</a>
    </div>
    <div class="userbox" style="margin-top:18px">
      <div id="userName">â€”</div>
      <div id="userRole">â€”</div>
    </div>
  </aside>

  <main class="main">
    <div class="header">
      <div>
        <h2 id="pageTitle">Dashboard</h2>
        <div class="small" id="pageSubtitle">Ringkasan operasional</div>
      </div>
    </div>

   <section id="summary" class="card section active">
  <!-- === WELCOME MESSAGE === -->
  <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 40px; border-radius: 12px; color: white; margin-bottom: 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
    <h1 style="margin: 0 0 8px 0; font-size: 32px; font-weight: 700;">Selamat Datang di TravelOps! ğŸ‘‹</h1>
    <p style="margin: 0; font-size: 18px; opacity: 0.95;" id="welcomeMessage">Kelola bisnis travel Anda dengan mudah</p>
  </div>

  <!-- === COMPARISON TOGGLE === -->
  <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 24px; padding: 16px; background: var(--bg-alt); border-radius: 12px; border: 1px solid var(--border-light);">
    <span style="font-weight: 600; color: var(--text-secondary);">ğŸ“Š Compare with:</span>
    <div style="display: flex; gap: 8px;">
      <button id="compareNone" class="comparison-btn active" data-compare="">Current Only</button>
      <button id="compareMonth" class="comparison-btn" data-compare="month">vs Last Month</button>
      <button id="compareYear" class="comparison-btn" data-compare="year">vs Last Year</button>
    </div>
    <span id="comparisonLabel" style="margin-left: auto; font-size: 14px; color: var(--text-secondary);"></span>
  </div>

  <!-- === QUICK METRICS === -->
  <div class="dashboard-metrics" style="margin-bottom: 24px;">
    <div class="metric-card" style="background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%); color: white;">
      <div class="metric-title" style="color: rgba(255,255,255,0.9);">ğŸ’° Total Sales</div>
      <div class="metric-value" id="totalSales" style="color: white;">Rp 0</div>
      <div class="metric-subtitle" id="salesAchievement" style="color: rgba(255,255,255,0.85);">-</div>
      <div id="salesChange" class="metric-change" style="display: none;"></div>
    </div>

    <div class="metric-card" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white;">
      <div class="metric-title" style="color: rgba(255,255,255,0.9);">ğŸ“ˆ Total Profit</div>
      <div class="metric-value" id="totalProfit" style="color: white;">Rp 0</div>
      <div class="metric-subtitle" id="profitAchievement" style="color: rgba(255,255,255,0.85);">-</div>
      <div id="profitChange" class="metric-change" style="display: none;"></div>
    </div>

    <div class="metric-card" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white;">
      <div class="metric-title" style="color: rgba(255,255,255,0.9);">ğŸ§³ Upcoming Tours</div>
      <div class="metric-value" id="upcomingToursCount" style="color: white;">0</div>
      <div class="metric-subtitle" style="color: rgba(255,255,255,0.85);">Dalam 30 hari</div>
    </div>

    <div class="metric-card" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white;">
      <div class="metric-title" style="color: rgba(255,255,255,0.9);">ğŸ“‹ Outstanding</div>
      <div class="metric-value" id="outstandingCount" style="color: white;">0</div>
      <div class="metric-subtitle" id="outstandingAmount" style="color: rgba(255,255,255,0.85);">Rp 0</div>
    </div>
  </div>

  <!-- === ADDITIONAL METRICS ROW === -->
  <div class="dashboard-metrics" style="margin-bottom: 24px;">
    <div class="metric-card">
      <div class="metric-title">ğŸ“„ Pending Documents</div>
      <div class="metric-value" id="pendingDocsCount">0</div>
      <div class="metric-subtitle">Perlu diproses</div>
    </div>
    <div class="metric-card">
      <div class="metric-title">ğŸš¢ Upcoming Cruise</div>
      <div class="metric-value" id="upcomingCruiseCount">0</div>
      <div class="metric-subtitle">Dalam 30 hari</div>
    </div>
    <div class="metric-card">
      <div class="metric-title">ğŸ¨ Hotel Bookings</div>
      <div class="metric-value" id="hotelBookingsCount">0</div>
      <div class="metric-subtitle">Bulan ini</div>
    </div>
    <div class="metric-card">
      <div class="metric-title">ğŸ“ Telecom Rentals</div>
      <div class="metric-value" id="telecomRentalsCount">0</div>
      <div class="metric-subtitle">Bulan ini</div>
    </div>
  </div>

  <!-- === YTD SUMMARY === -->
  <div style="background: linear-gradient(135deg, #1e293b 0%, #334155 100%); padding: 24px; border-radius: 12px; color: white; margin-bottom: 24px;">
    <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
      <h3 style="margin: 0; font-size: 18px;">ğŸ“… Year-to-Date Summary <span id="ytdYear" style="font-weight: normal; opacity: 0.8;"></span></h3>
    </div>
    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px;">
      <div>
        <div style="font-size: 13px; opacity: 0.8; margin-bottom: 4px;">YTD Sales</div>
        <div id="ytdSales" style="font-size: 24px; font-weight: 700;">Rp 0</div>
        <div style="font-size: 12px; opacity: 0.7;">Target: <span id="ytdTargetSales">Rp 0</span></div>
      </div>
      <div>
        <div style="font-size: 13px; opacity: 0.8; margin-bottom: 4px;">YTD Profit</div>
        <div id="ytdProfit" style="font-size: 24px; font-weight: 700;">Rp 0</div>
        <div style="font-size: 12px; opacity: 0.7;">Target: <span id="ytdTargetProfit">Rp 0</span></div>
      </div>
      <div>
        <div style="font-size: 13px; opacity: 0.8; margin-bottom: 4px;">Sales Achievement</div>
        <div id="ytdSalesAchievement" style="font-size: 24px; font-weight: 700;">0%</div>
        <div style="height: 6px; background: rgba(255,255,255,0.2); border-radius: 3px; overflow: hidden; margin-top: 8px;">
          <div id="ytdSalesBar" style="height: 100%; background: #10b981; width: 0%; transition: width 0.5s;"></div>
        </div>
      </div>
      <div>
        <div style="font-size: 13px; opacity: 0.8; margin-bottom: 4px;">Profit Achievement</div>
        <div id="ytdProfitAchievement" style="font-size: 24px; font-weight: 700;">0%</div>
        <div style="height: 6px; background: rgba(255,255,255,0.2); border-radius: 3px; overflow: hidden; margin-top: 8px;">
          <div id="ytdProfitBar" style="height: 100%; background: #10b981; width: 0%; transition: width 0.5s;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- === STAFF LEADERBOARD === -->
  <div class="chart-container" style="margin-bottom: 24px;">
    <div class="chart-header">
      <div class="chart-title">ğŸ† Staff Performance Leaderboard</div>
      <div class="chart-subtitle">Top performers this month</div>
    </div>
    <div style="overflow-x: auto;">
      <table class="table">
        <thead>
          <tr>
            <th style="width: 50px;">Rank</th>
            <th>Staff Name</th>
            <th style="text-align: right;">Total Sales</th>
            <th style="text-align: right;">Total Profit</th>
            <th style="text-align: center;">Transactions</th>
            <th style="text-align: right;">Avg/Transaction</th>
          </tr>
        </thead>
        <tbody id="staffLeaderboardTable">
          <tr><td colspan="6" style="text-align: center; padding: 20px; color: #9ca3af;">Memuat data...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- === UPCOMING TOURS NOTIFICATION === -->
  <div class="chart-container" style="margin-bottom: 24px;">
    <div class="chart-header">
      <div class="chart-title">ğŸš¨ Keberangkatan dalam 30 Hari</div>
      <div class="chart-subtitle">Tour yang akan berangkat segera</div>
    </div>
    <div style="max-height: 400px; overflow-y: auto;">
      <table class="table">
        <thead>
          <tr>
            <th>Tanggal Keberangkatan</th>
            <th>Kode Tour</th>
            <th>Penumpang Utama</th>
            <th>Region</th>
            <th>Jumlah Peserta</th>
            <th>Staff</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="upcomingToursTable">
          <tr><td colspan="7" style="text-align: center; padding: 20px; color: #9ca3af;">Memuat data...</td></tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- === QUICK LINKS === -->
  <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">
    <a href="/sales-dashboard.html" style="text-decoration: none;">
      <div style="background: white; border: 2px solid #e5e7eb; border-radius: 12px; padding: 24px; text-align: center; transition: all 0.3s; cursor: pointer;" onmouseover="this.style.borderColor='#3b82f6'; this.style.transform='translateY(-2px)';" onmouseout="this.style.borderColor='#e5e7eb'; this.style.transform='translateY(0)';">
        <div style="font-size: 48px; margin-bottom: 12px;">ğŸ’°</div>
        <div style="font-size: 18px; font-weight: 600; color: #111827;">Sales Dashboard</div>
        <div style="font-size: 14px; color: #6b7280; margin-top: 4px;">Analisis penjualan lengkap dengan filter</div>
      </div>
    </a>
    
    <a href="/tours-dashboard.html" style="text-decoration: none;">
      <div style="background: white; border: 2px solid #e5e7eb; border-radius: 12px; padding: 24px; text-align: center; transition: all 0.3s; cursor: pointer;" onmouseover="this.style.borderColor='#10b981'; this.style.transform='translateY(-2px)';" onmouseout="this.style.borderColor='#e5e7eb'; this.style.transform='translateY(0)';">
        <div style="font-size: 48px; margin-bottom: 12px;">ğŸ§³</div>
        <div style="font-size: 18px; font-weight: 600; color: #111827;">Tours Dashboard</div>
        <div style="font-size: 14px; color: #6b7280; margin-top: 4px;">Kelola tour & peserta dengan filter</div>
      </div>
    </a>
    
    <a href="/documents-dashboard.html" style="text-decoration: none;">
      <div style="background: white; border: 2px solid #e5e7eb; border-radius: 12px; padding: 24px; text-align: center; transition: all 0.3s; cursor: pointer;" onmouseover="this.style.borderColor='#f59e0b'; this.style.transform='translateY(-2px)';" onmouseout="this.style.borderColor='#e5e7eb'; this.style.transform='translateY(0)';">
        <div style="font-size: 48px; margin-bottom: 12px;">ğŸ“„</div>
        <div style="font-size: 18px; font-weight: 600; color: #111827;">Documents Dashboard</div>
        <div style="font-size: 14px; color: #6b7280; margin-top: 4px;">Proses dokumen dengan filter detail</div>
      </div>
    </a>
  </div>
  
  <!-- Info message about filters -->
  <div style="margin-top: 24px; padding: 16px; background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-left: 4px solid #3b82f6; border-radius: 8px; box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);">
    <div style="display: flex; align-items: start; gap: 12px;">
      <div style="font-size: 1.5rem;">â„¹ï¸</div>
      <div>
        <strong style="color: #1e40af; font-size: 1.05rem;">Butuh Filter Data?</strong>
        <p style="margin: 4px 0 0 0; color: #1e3a8a; font-size: 0.9rem; line-height: 1.5;">Gunakan <strong>dashboard khusus</strong> di atas untuk filter berdasarkan staff, region, periode, dan kriteria lainnya. Dashboard utama ini menampilkan <strong>ringkasan keseluruhan data</strong> tanpa filter.</p>
      </div>
    </div>
  </div>
</section>

    <!-- Sales -->
    <section id="sales" class="card section">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3>Sales</h3>
        <div>
          <button id="addSalesBtn" class="btn primary">+ Tambah Sales</button>
          <button data-filter-entity="sales" class="btn">ğŸ” Filter</button>
          <button id="exportSales" class="btn">Export CSV</button>
          <button id="downloadSalesTemplate" class="btn">Download Template</button>
          <input id="importSalesFile" type="file" accept=".csv" class="hidden"/>
          <button id="importSalesBtn" class="btn">Import CSV</button>
        </div>
      </div>
      <div class="searchbar">
        <input id="salesSearch" placeholder="Cari invoice / staff / status..." style="flex:1;padding:8px;border-radius:8px;border:1px solid #d1d5db">
        <select id="salesPageSize" data-pagesize-entity="sales">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
      <table class="table"><thead><tr>
        <th class="sortable" data-column="transaction_date">Tanggal</th>
        <th class="sortable" data-column="invoice_no">Invoice</th>
        <th class="sortable" data-column="staff_name">Staff</th>
        <th class="sortable" data-column="sales_amount">Sales</th>
        <th class="sortable" data-column="profit_amount">Profit</th>
        <th>Aksi</th>
      </tr></thead><tbody id="tblSales"></tbody></table>
      <div class="pagination" id="salesPagination"></div>
    </section>

    <!-- Tours -->
    <section id="tours" class="card section">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3>Tours</h3>
        <div>
          <button id="addTourBtn" class="btn primary">+ Tambah Tour</button>
          <button data-filter-entity="tours" class="btn">ğŸ” Filter</button>
          <button id="exportTours" class="btn">Export CSV</button>
          <button id="downloadToursTemplate" class="btn">Download Template</button>
          <input id="importToursFile" type="file" accept=".csv" class="hidden"/>
          <button id="importToursBtn" class="btn">Import CSV</button>
        </div>
      </div>
            <div class="searchbar">
        <input id="toursSearch" placeholder="Cari code / staff / region..." style="flex:1;padding:8px;border-radius:8px;border:1px solid #d1d5db">
        <select id="toursPageSize" data-pagesize-entity="tours">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
      <div class="table-scroll-wrapper">
        <table class="table table-compact"><thead><tr>
          <th class="sortable" data-column="registration_date">Reg</th>
          <th class="sortable" data-column="tour_code">Code</th>
          <th class="sortable" data-column="booking_code">Booking</th>
          <th class="sortable" data-column="jumlah_peserta">Pax</th>
          <th class="sortable" data-column="departure_date">Depart</th>
          <th class="sortable" data-column="region_id">Region</th>
          <th class="sortable" data-column="status">Status</th>
          <th class="sortable" data-column="lead_passenger">Lead</th>
          <th class="sortable" data-column="total_nominal_sales">Total</th>
          <th class="sortable" data-column="staff_name">Staff</th>
          <th>Actions</th>
        </tr></thead><tbody id="tblTours"></tbody></table>
      </div>
      <div class="pagination" id="toursPagination"></div>
    </section>

    <!-- Documents -->
    <section id="documents" class="card section">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3>Documents</h3>
        <div>
          <button id="addDocBtn" class="btn primary">+ Tambah Dokumen</button>
          <button data-filter-entity="documents" class="btn">ğŸ” Filter</button>
          <button id="exportDocs" class="btn">Export CSV</button>
          <button id="downloadDocsTemplate" class="btn">Download Template</button>
          <input id="importDocsFile" type="file" accept=".csv" class="hidden"/>
          <button id="importDocsBtn" class="btn">Import CSV</button>
        </div>
      </div>
      <div class="searchbar">
        <input id="documentsSearch" placeholder="Cari nama / passport / booking..." style="flex:1;padding:8px;border-radius:8px;border:1px solid #d1d5db">
        <select id="docsPageSize" data-pagesize-entity="documents">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
      <table class="table"><thead><tr>
        <th class="sortable" data-column="receive_date">Receive</th>
        <th class="sortable" data-column="guest_name">Guest</th>
        <th class="sortable" data-column="process_type">Process</th>
        <th class="sortable" data-column="staff_name">Staff</th>
        <th>Aksi</th>
      </tr></thead><tbody id="tblDocs"></tbody></table>
      <div class="pagination" id="docsPagination"></div>
    </section>

    <!-- Targets -->
    <section id="targets" class="card section">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3>Targets</h3>
        <div>
          <button id="addTargetBtn" class="btn primary">+ Tambah Target</button>
          <button data-filter-entity="targets" class="btn">ğŸ” Filter</button>
          <button id="exportTargets" class="btn">Export CSV</button>
          <button id="downloadTargetsTemplate" class="btn">Download Template</button>
          <input id="importTargetsFile" type="file" accept=".csv" class="hidden"/>
          <button id="importTargetsBtn" class="btn">Import CSV</button>
        </div>
      </div>
      <div class="searchbar">
        <input id="targetsSearch" placeholder="Cari staff / bulan / tahun..." style="flex:1;padding:8px;border-radius:8px;border:1px solid #d1d5db">
        <select id="targetsPageSize" data-pagesize-entity="targets">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
      <table class="table"><thead><tr>
        <th class="sortable" data-column="month">Bulan</th>
        <th class="sortable" data-column="year">Tahun</th>
        <th class="sortable" data-column="staff_name">Staff</th>
        <th class="sortable" data-column="target_sales">Target Sales</th>
        <th class="sortable" data-column="target_profit">Target Profit</th>
        <th>Aksi</th>
      </tr></thead>
      <tbody id="tblTargets"></tbody></table>
      <div class="pagination" id="targetsPagination"></div>
    </section>

    <!-- Regions -->
    <section id="regions" class="card section">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3>Regions</h3>
        <div>
          <button id="addRegionBtn" class="btn primary">+ Tambah Region</button>
          <button data-filter-entity="regions" class="btn">ğŸ” Filter</button>
        </div>
      </div>
      <div class="searchbar">
        <input id="regionsSearch" placeholder="Cari nama region..." style="flex:1;padding:8px;border-radius:8px;border:1px solid #d1d5db">
        <select id="regionsPageSize" data-pagesize-entity="regions">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
      <table class="table"><thead><tr>
        <th class="sortable" data-column="id">ID</th>
        <th class="sortable" data-column="region_name">Region</th>
        <th>Aksi</th>
      </tr></thead><tbody id="tblRegions"></tbody></table>
      <div class="pagination" id="regionsPagination"></div>
    </section>

<section id="activity" class="section">
  <div class="controls"><h3>Riwayat Aktivitas</h3></div>
  <div class="card">
    <table>
      <thead>
        <tr>
          <th>Waktu</th>
          <th>User</th>
          <th>Aksi</th>
          <th>Entitas</th>
          <th>ID</th>
          <th>Keterangan</th>
        </tr>
      </thead>
      <tbody id="tblActivity"></tbody>
    </table>
  </div>
</section>


    <!-- Users -->
    <section id="users" class="card section">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3>Users</h3>
        <div>
          <button id="addUserBtn" class="btn primary">+ Tambah User</button>
          <button data-filter-entity="users" class="btn">ğŸ” Filter</button>
        </div>
      </div>
      <div class="searchbar">
        <input id="usersSearch" placeholder="Cari username / nama / email..." style="flex:1;padding:8px;border-radius:8px;border:1px solid #d1d5db">
        <select id="usersPageSize" data-pagesize-entity="users">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
      <table class="table"><thead><tr>
        <th class="sortable" data-column="username">Username</th>
        <th class="sortable" data-column="name">Name</th>
        <th class="sortable" data-column="type">Type</th>
        <th>Aksi</th>
      </tr></thead><tbody id="tblUsers"></tbody></table>
      <div class="pagination" id="usersPagination"></div>
    </section>

    <!-- Telecom -->
    <section id="telecom" class="card section">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3>Telecom</h3>
        <div>
          <button id="addTelecomBtn" class="btn primary">+ Tambah Telecom</button>
          <button data-filter-entity="telecom" class="btn">ğŸ” Filter</button>
          <button id="exportTelecom" class="btn">Export CSV</button>
        </div>
      </div>
      <div class="searchbar">
        <input id="telecomSearch" placeholder="Cari nama / no telephone / type..." style="flex:1;padding:8px;border-radius:8px;border:1px solid #d1d5db">
        <select id="telecomPageSize" data-pagesize-entity="telecom">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
      <table class="table">
        <thead>
          <tr>
            <th class="sortable" data-column="nama">Nama</th>
            <th class="sortable" data-column="no_telephone">No Telephone</th>
            <th class="sortable" data-column="type_product">Type Product</th>
            <th class="sortable" data-column="region_id">Negara</th>
            <th class="sortable" data-column="tanggal_mulai">Mulai</th>
            <th class="sortable" data-column="tanggal_selesai">Selesai</th>
            <th class="sortable" data-column="staff_name">Staff</th>
            <th class="sortable" data-column="deposit">Deposit</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="tblTelecom"></tbody>
      </table>
      <div class="pagination" id="telecomPagination"></div>
    </section>

    <!-- Hotel Bookings -->
    <section id="hotel_bookings" class="card section">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3>Hotel Bookings</h3>
        <div>
          <button id="addHotelBookingBtn" class="btn primary">+ Tambah Booking</button>
          <button data-filter-entity="hotel_bookings" class="btn">ğŸ” Filter</button>
          <button id="exportHotelBookings" class="btn">Export CSV</button>
        </div>
      </div>
      <div class="searchbar">
        <input id="hotelBookingsSearch" placeholder="Cari hotel / guest / konfirmasi..." style="flex:1;padding:8px;border-radius:8px;border:1px solid #d1d5db">
        <select id="hotelBookingsPageSize" data-pagesize-entity="hotel_bookings">
          <option value="5">5</option>
          <option value="10" selected>10</option>
          <option value="25">25</option>
          <option value="50">50</option>
        </select>
      </div>
      <table class="table">
        <thead>
          <tr>
            <th class="sortable" data-column="check_in">Check In</th>
            <th class="sortable" data-column="check_out">Check Out</th>
            <th class="sortable" data-column="hotel_name">Hotel</th>
            <th class="sortable" data-column="region_id">Region</th>
            <th class="sortable" data-column="confirmation_number">Konfirmasi</th>
            <th class="sortable" data-column="guest_list">Guest List</th>
            <th class="sortable" data-column="staff_name">Staff</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="tblHotelBookings"></tbody>
      </table>
      <div class="pagination" id="hotelBookingsPagination"></div>
    </section>

    <!-- Profile -->
    <section id="profile" class="section">
      <div class="profile-container">
        <!-- Profile Header Card -->
        <div class="card profile-header">
          <div class="profile-avatar">
            <div class="avatar-circle">
              <span id="profileInitials">?</span>
            </div>
          </div>
          <div class="profile-info">
            <h2 id="profileName">Loading...</h2>
            <p class="profile-role" id="profileRole">-</p>
            <p class="profile-username" id="profileUsername">@username</p>
          </div>
        </div>

        <!-- Profile Details Card -->
        <div class="card profile-details">
          <h3>Informasi Akun</h3>
          <div class="detail-grid">
            <div class="detail-item">
              <label>Username</label>
              <div id="detailUsername">-</div>
            </div>
            <div class="detail-item">
              <label>Nama Lengkap</label>
              <div id="detailName">-</div>
            </div>
            <div class="detail-item">
              <label>Email</label>
              <div id="detailEmail">-</div>
            </div>
            <div class="detail-item">
              <label>Tipe Akun</label>
              <div id="detailType">-</div>
            </div>
          </div>
        </div>

        <!-- Change Password Card -->
        <div class="card profile-password">
          <h3>Ubah Password</h3>
          <p class="small" style="margin-bottom: 16px; color: #6b7280;">
            Password minimal 8 karakter dan harus mengandung huruf besar, huruf kecil, serta angka.
          </p>
          <form id="pwForm">
            <div class="form-group">
              <label>Password Baru</label>
              <input type="password" name="password" required minlength="8" pattern="(?=.*[a-z])(?=.*[A-Z])(?=.*\\d).{8,}" placeholder="Min 8: huruf besar, kecil & angka">
            </div>
            <div class="form-group">
              <label>Konfirmasi Password</label>
              <input type="password" name="password_confirm" required minlength="8" pattern="(?=.*[a-z])(?=.*[A-Z])(?=.*\\d).{8,}" placeholder="Ketik ulang password baru">
            </div>
            <button class="btn btn-primary" type="submit">
              <span>ğŸ”’</span> Ubah Password
            </button>
          </form>
        </div>

        <!-- Activity Summary (if admin) -->
        <div class="card profile-stats" id="profileStats" style="display: none;">
          <h3>Statistik Aktivitas</h3>
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-value" id="statSales">0</div>
              <div class="stat-label">Total Sales</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="statTours">0</div>
              <div class="stat-label">Total Tours</div>
            </div>
            <div class="stat-item">
              <div class="stat-value" id="statDocs">0</div>
              <div class="stat-label">Total Dokumen</div>
            </div>
          </div>
        </div>

        <!-- Email Notification Testing (Admin Only) -->
        <div class="card" id="emailTestingPanel" style="display: none;">
          <h3 style="margin-top: 0; color: #2563eb; display: flex; align-items: center; gap: 8px;">
            <span style="font-size: 24px;">ğŸ“§</span>
            Email Notification System
          </h3>
          
          <div id="emailConfigStatus" style="padding: 16px; border-radius: 8px; margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
            <span id="emailStatusIcon" style="font-size: 24px;"></span>
            <div>
              <strong id="emailStatusTitle">Checking configuration...</strong>
              <p id="emailStatusMessage" style="margin: 4px 0 0 0; color: #6b7280; font-size: 0.9rem;"></p>
            </div>
          </div>

          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; margin-bottom: 24px;">
            <!-- Test Email Card -->
            <div style="background: #f9fafb; padding: 20px; border-radius: 12px; border: 1px solid #e5e7eb;">
              <h4 style="margin-top: 0; color: #1f2937; font-size: 16px; display: flex; align-items: center; gap: 8px;">
                <span>âœ‰ï¸</span> Test Email
              </h4>
              <p style="color: #6b7280; font-size: 0.9rem; margin-bottom: 16px;">
                Send a test email to verify SMTP configuration
              </p>
              <div style="margin-bottom: 12px;">
                <input 
                  type="email" 
                  id="testEmailInput" 
                  placeholder="recipient@example.com"
                  style="width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 0.95rem;"
                />
              </div>
              <button 
                id="sendTestEmailBtn" 
                class="btn primary" 
                style="width: 100%;"
              >
                Send Test Email
              </button>
            </div>

            <!-- Manual Trigger Card -->
            <div style="background: #fef3c7; padding: 20px; border-radius: 12px; border: 1px solid #fbbf24;">
              <h4 style="margin-top: 0; color: #92400e; font-size: 16px; display: flex; align-items: center; gap: 8px;">
                <span>âš¡</span> Trigger Reminders
              </h4>
              <p style="color: #78350f; font-size: 0.9rem; margin-bottom: 16px;">
                Manually check and send departure reminders now
              </p>
              <button 
                id="triggerRemindersBtn" 
                class="btn" 
                style="width: 100%; background: #f59e0b; color: white;"
              >
                Trigger Now
              </button>
              <p style="margin-top: 12px; font-size: 0.85rem; color: #78350f;">
                <strong>Note:</strong> Automated schedule runs daily at 9:00 AM
              </p>
            </div>

            <!-- Reminder Stats Card -->
            <div style="background: #ecfdf5; padding: 20px; border-radius: 12px; border: 1px solid #10b981;">
              <h4 style="margin-top: 0; color: #065f46; font-size: 16px; display: flex; align-items: center; gap: 8px;">
                <span>ğŸ“Š</span> Statistics
              </h4>
              <p style="color: #047857; font-size: 0.9rem; margin-bottom: 16px;">
                View sent reminder statistics
              </p>
              <button 
                id="viewStatsBtn" 
                class="btn" 
                style="width: 100%; background: #10b981; color: white;"
              >
                View Stats
              </button>
            </div>
          </div>

          <!-- Results Display -->
          <div id="emailTestResults" style="display: none; margin-top: 20px;"></div>

          <!-- Stats Table -->
          <div id="emailStatsTable" style="display: none; margin-top: 20px;">
            <h4 style="color: #1f2937; margin-bottom: 12px;">Recent Reminder Activity</h4>
            <div style="overflow-x: auto;">
              <table class="table">
                <thead>
                  <tr>
                    <th>Days Before</th>
                    <th>Count</th>
                    <th>Date Sent</th>
                  </tr>
                </thead>
                <tbody id="statsTableBody"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Admin Panel (Admin Only) -->
    <section id="admin" class="section">
      <div style="display: grid; gap: 24px;">
        <!-- System Health Card -->
        <div class="card">
          <h3 style="margin: 0 0 20px 0; display: flex; align-items: center; gap: 10px;">
            <span style="font-size: 28px;">ğŸ›¡ï¸</span> System Health Dashboard
          </h3>
          <div id="systemStatsLoading" style="text-align: center; padding: 40px;">
            <div class="loading-spinner large"></div>
            <p style="margin-top: 16px; color: #6b7280;">Loading system stats...</p>
          </div>
          <div id="systemStatsContent" style="display: none;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 16px; margin-bottom: 24px;">
              <div class="stat-card">
                <div class="stat-value" id="statTotalUsers">-</div>
                <div class="stat-label">Total Users</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="statActiveUsers">-</div>
                <div class="stat-label">Active (24h)</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="statLockedUsers">-</div>
                <div class="stat-label">Locked Users</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="statTotalSales">-</div>
                <div class="stat-label">Sales Records</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="statTotalTours">-</div>
                <div class="stat-label">Tours</div>
              </div>
              <div class="stat-card">
                <div class="stat-value" id="statTotalDocs">-</div>
                <div class="stat-label">Documents</div>
              </div>
            </div>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
              <div style="background: #f0fdf4; padding: 16px; border-radius: 8px; border: 1px solid #bbf7d0;">
                <div style="font-weight: 600; color: #166534;">Database</div>
                <div style="font-size: 14px; color: #15803d;" id="dbInfo">-</div>
              </div>
              <div style="background: #eff6ff; padding: 16px; border-radius: 8px; border: 1px solid #bfdbfe;">
                <div style="font-weight: 600; color: #1d4ed8;">Server Uptime</div>
                <div style="font-size: 14px; color: #2563eb;" id="serverUptime">-</div>
              </div>
              <div style="background: #fef3c7; padding: 16px; border-radius: 8px; border: 1px solid #fde68a;">
                <div style="font-weight: 600; color: #92400e;">Activity (7 days)</div>
                <div style="font-size: 14px; color: #b45309;" id="recentActivity">-</div>
              </div>
            </div>
            <button id="refreshSystemStats" class="btn btn-secondary" style="margin-top: 20px;">
              ğŸ”„ Refresh Stats
            </button>
          </div>
        </div>

        <!-- Activity Logs Card -->
        <div class="card">
          <h3 style="margin: 0 0 20px 0; display: flex; align-items: center; gap: 10px;">
            <span style="font-size: 28px;">ğŸ“‹</span> Activity Logs
          </h3>
          <div class="controls" style="margin-bottom: 16px;">
            <input type="text" id="activitySearch" placeholder="Search logs..." style="max-width: 300px;">
            <select id="activityFilter" style="max-width: 150px;">
              <option value="">All Actions</option>
              <option value="LOGIN">Login</option>
              <option value="LOGOUT">Logout</option>
              <option value="CREATE">Create</option>
              <option value="UPDATE">Update</option>
              <option value="DELETE">Delete</option>
              <option value="LOCK">Lock</option>
              <option value="UNLOCK">Unlock</option>
            </select>
            <button id="refreshActivityLogs" class="btn btn-secondary">ğŸ”„ Refresh</button>
          </div>
          <div style="overflow-x: auto; max-height: 500px; overflow-y: auto;">
            <table class="table" id="activityLogsTable">
              <thead>
                <tr>
                  <th>Time</th>
                  <th>User</th>
                  <th>Action</th>
                  <th>Entity</th>
                  <th>Record ID</th>
                  <th>Description</th>
                </tr>
              </thead>
              <tbody id="activityLogsBody">
                <tr><td colspan="6" style="text-align: center; padding: 40px;">Loading...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

  </main>
</div>

<!-- Enhanced Modal -->
<div id="modal" class="modal">
  <div class="modal-card">
    <div class="modal-header">
      <div id="modalTitle" class="modal-title"></div>
      <button type="button" class="modal-close" id="modalClose">&times;</button>
    </div>
    <form id="modalForm" class="modal-form">
      <div id="modalBody" class="modal-body"></div>
      <div class="modal-footer">
        <button type="button" id="modalCancel" class="btn btn-secondary">Batal</button>
        <button type="submit" id="modalSave" class="btn btn-primary">Simpan</button>
      </div>
    </form>
  </div>
</div>

<!-- Load shared auth module first to provide fetchJson & token management -->
<script src="/js/toast.js"></script>
<script src="/js/utils.js"></script>
<script src="/js/confirm-dialog.js"></script>
<script src="/js/accessibility.js"></script>
<script src="/js/mobile-menu.js"></script>
<script src="/js/table-enhancer.js"></script>
<script src="/js/filter-manager.js"></script>
<script src="/js/chart-enhancer.js"></script>
<script src="/js/quick-view.js"></script>
<script src="/js/dashboard-customizer.js"></script>
<script src="/js/advanced-search.js"></script>
<script src="/js/form-builder.js"></script>
<script src="/js/form-validator.js"></script>
<script src="/js/crud-modal.js"></script>
<script type="module" src="/js/auth-common.js"></script>
<script src="/js/logout-handler.js"></script>
<!-- Dashboard logic (now relies on auth-common for auth utilities) -->
<script src="/js/dashboard.js?v=9"></script>
<script defer src="/js/crud-handlers.js?v=7"></script>

<!-- Service Worker Registration (external to comply with CSP) -->
<script src="/js/sw-register.js"></script>

<!-- App Enhancements: Auto-refresh, Notifications, Error Handling -->
<script src="/js/app-enhancements.js"></script>

<!-- Removed logout confirmation modal; using direct navigation to /logout.html -->

</body>
</html>